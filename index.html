<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
    <title>Roteiro Europa 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .content-wrapper {
            display: flex;
            gap: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background-color: #e9ecef;
        }

        .tab-button.active {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }

        /* Estilos do Container do Mapa */
        .map-container {
            width: 70%;
            position: relative;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f8f9fa;
            aspect-ratio: 4/3;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Estilos dos Marcadores e Popups do Leaflet */
        .leaflet-popup-content {
            font-size: 14px;
            line-height: 1.4;
            padding: 8px;
        }

        .leaflet-popup-content h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 3px;
        }

        .custom-marker {
            background-color: #e74c3c;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
        }

        .custom-marker:hover {
            background-color: #c0392b;
            transform: scale(1.2);
        }

        .custom-marker.active {
            background-color: #2ecc71;
            box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.3);
        }

        /* Painel de Informa√ß√µes */
        .info-panel {
            width: 30%;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 800px;
            overflow-y: auto;
        }

        .city-info {
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .city-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .info-section {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .booking-button {
            display: inline-block;
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .booking-button:hover {
            background-color: #2980b9;
        }

        /* Estilos do Itiner√°rio */
        .itinerary-day {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .itinerary-day h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .full-itinerary {
            display: none;
            padding: 20px;
        }

        /* Estilos do Resumo de Custos */
        .cost-summary {
            background-color: #f1f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .cost-summary h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px dashed #ccc;
        }

        .total-cost {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #3498db;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Estilos para as op√ß√µes de transporte */
        .transport-options {
            margin-top: 10px;
        }

        .transport-option {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }

        .transport-train {
            border-left-color: #2ecc71;
        }

        .transport-bus {
            border-left-color: #f39c12;
        }

        .transport-flight {
            border-left-color: #9b59b6;
        }

        .transport-car {
            border-left-color: #e74c3c;
        }

        .transport-option h4 {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .transport-option p {
            margin: 5px 0;
            font-size: 14px;
        }

        .economy-badge, .comfort-badge, .time-badge {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .economy-badge {
            background-color: #2ecc71;
            color: white;
        }

        .comfort-badge {
            background-color: #9b59b6;
            color: white;
        }

        .time-badge {
            background-color: #f39c12;
            color: white;
        }

        /* Resumo visual dos custos */
        .cost-charts {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        .chart-container {
            width: 45%;
            min-width: 300px;
            border-radius: 8px;
            background-color: white;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .map-container, .info-panel {
                width: 100%;
            }
            
            .map-container {
                height: 400px;
            }

            .chart-container {
                width: 100%;
            }
        }

        /* Estilos adicionados para transporte */
        .transport-recommended {
            font-weight: bold;
            color: #27ae60;
        }

        .budget-overview {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .budget-overview.over-budget {
            background-color: #e74c3c;
        }

        .budget-overview h3 {
            color: white;
            margin-bottom: 10px;
        }

        .budget-meter {
            height: 24px;
            background-color: #eee;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .budget-fill {
            height: 100%;
            background-color: #3498db;
            width: 0%; /* Ser√° ajustado com JavaScript */
            transition: width 1s ease-in-out;
        }

        .budget-over {
            background-color: #e74c3c;
        }

        .budget-within {
            background-color: #2ecc71;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Roteiro Lua de Mel 2025</h1>
        
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="map" onclick="showTab('map')">Mapa</button>
            <button class="tab-button" data-tab="full-itinerary" onclick="showTab('full-itinerary')">Roteiro Completo</button>
            <button class="tab-button" data-tab="summary" onclick="showTab('summary')">Resumo Financeiro</button>
        </div>
        
        <div class="content-wrapper" id="mapView">
            <div class="map-container">
                <div id="map"></div>
            </div>
            <div class="info-panel" id="infoPanel">
                <div id="cityInfo">
                    Selecione uma cidade no mapa para ver detalhes
                </div>
            </div>
        </div>

        <div class="full-itinerary" id="fullItinerary"></div>
    </div>

    <script>
        const itineraryData = {
            cities: {
                albufeira: {
                    name: "Albufeira (Casamento)",
                    coordinates: { lat: 37.0891, lng: -8.2401 },
                    dates: "12/04 - 14/04",
                    activities: [
                        "Chegada a Albufeira (12/04)",
                        "Casamento (13/04)",
                        "Prepara√ß√£o para pr√≥ximo destino (14/04)"
                    ],
                    accommodation: {
                        name: "Hospedagem j√° confirmada",
                        cost: 0, // J√° pago/reservado
                        notes: "Hospedagem j√° confirmada para estas datas"
                    }
                },
                madrid: {
                    name: "Madrid",
                    coordinates: { lat: 40.4168, lng: -3.7038 },
                    dates: "14/04 - 15/04",
                    transport: {
                        from: "Albufeira",
                        options: [
                            {
                                type: "voo",
                                company: "Iberia/Ryanair (Faro)",
                                duration: "1h45",
                                cost: 90,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Melhor op√ß√£o considerando tempo",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "onibus",
                                company: "ALSA",
                                duration: "10-12h",
                                cost: 65,
                                bookingUrl: "https://www.alsa.es",
                                notes: "Muito longo, n√£o recomendado",
                                recommended: false
                            },
                            {
                                type: "trem",
                                company: "N√£o dispon√≠vel diretamente",
                                duration: "N/A",
                                cost: 0,
                                bookingUrl: "",
                                notes: "N√£o h√° conex√£o direta vi√°vel",
                                recommended: false
                            }
                        ]
                    },
                    activities: [
                        "Est√°dio Santiago Bernab√©u (Tour: 25‚Ç¨)",
                        "Plaza Mayor",
                        "Museu do Prado",
                        "Parque Retiro",
                        "Pal√°cio Real"
                    ],
                    accommodation: {
                        name: "Hostel Madrid Motion",
                        cost: 60,
                        bookingUrl: "https://www.hostelworld.com"
                    }
                },
                valencia: {
                    name: "Valencia",
                    coordinates: { lat: 39.4699, lng: -0.3763 },
                    dates: "16/04 - 17/04",
                    transport: {
                        from: "Madrid",
                        options: [
                            {
                                type: "trem",
                                company: "Renfe (AVE)",
                                duration: "1h40",
                                cost: 45,
                                bookingUrl: "https://www.renfe.com",
                                notes: "Trem de alta velocidade, muito confort√°vel",
                                recommended: true,
                                badge: "conforto"
                            },
                            {
                                type: "onibus",
                                company: "ALSA",
                                duration: "4h-4h30",
                                cost: 30,
                                bookingUrl: "https://www.alsa.es",
                                notes: "Mais econ√¥mico que o trem",
                                recommended: false,
                                badge: "economia"
                            },
                            {
                                type: "voo",
                                company: "Iberia",
                                duration: "1h + tempo no aeroporto",
                                cost: 100,
                                bookingUrl: "https://www.iberia.com",
                                notes: "N√£o recomendado para esta dist√¢ncia",
                                recommended: false
                            }
                        ]
                    },
                    activities: [
                        "L'Oceanogr√†fic (Maior ocean√°rio da Europa: 35‚Ç¨)",
                        "Cidade das Artes e Ci√™ncias",
                        "Centro hist√≥rico de Val√™ncia",
                        "Praia de Malvarrosa"
                    ],
                    accommodation: {
                        name: "Hostel Valencia Lounge",
                        cost: 64,
                        bookingUrl: "https://www.hostelworld.com"
                    }
                },
                geneva: {
                    name: "Geneva",
                    coordinates: { lat: 46.2044, lng: 6.1432 },
                    dates: "18/04 - 19/04",
                    transport: {
                        from: "Valencia",
                        options: [
                            {
                                type: "voo",
                                company: "EasyJet/Swiss",
                                duration: "2h",
                                cost: 150,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "√önica op√ß√£o vi√°vel para esta dist√¢ncia",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "trem",
                                company: "M√∫ltiplas conex√µes",
                                duration: "12-14h",
                                cost: 180,
                                bookingUrl: "https://www.raileurope.com",
                                notes: "Muito longo, n√£o recomendado",
                                recommended: false
                            },
                            {
                                type: "onibus",
                                company: "Indispon√≠vel diretamente",
                                duration: "+20h",
                                cost: 0,
                                bookingUrl: "",
                                notes: "N√£o h√° op√ß√µes diretas pr√°ticas",
                                recommended: false
                            }
                        ]
                    },
                    activities: [
                        "Jet d'Eau",
                        "CERN (visita gratuita com reserva)",
                        "Passeio pelo lago Leman",
                        "Catedral de S√£o Pedro",
                        "Pal√°cio das Na√ß√µes"
                    ],
                    accommodation: {
                        name: "Geneva Hostel",
                        cost: 180,
                        bookingUrl: "https://www.genevahostel.ch"
                    }
                },
                zurich: {
                    name: "Zurich",
                    coordinates: { lat: 47.3769, lng: 8.5417 },
                    dates: "20/04 - 21/04",
                    transport: {
                        from: "Geneva",
                        options: [
                            {
                                type: "trem",
                                company: "SBB (Ferrovias Su√≠√ßas)",
                                duration: "2h45-3h",
                                cost: 60,
                                bookingUrl: "https://www.sbb.ch",
                                notes: "Excelente, vistas panor√¢micas",
                                recommended: true,
                                badge: "conforto"
                            },
                            {
                                type: "onibus",
                                company: "FlixBus",
                                duration: "3h30-4h",
                                cost: 25,
                                bookingUrl: "https://www.flixbus.ch",
                                notes: "Mais econ√¥mico que o trem",
                                recommended: false,
                                badge: "economia"
                            },
                            {
                                type: "voo",
                                company: "Swiss",
                                duration: "45min + tempo no aeroporto",
                                cost: 130,
                                bookingUrl: "https://www.swiss.com",
                                notes: "N√£o pr√°tico para esta dist√¢ncia",
                                recommended: false
                            }
                        ]
                    },
                    activities: [
                        "Lago Zurich",
                        "Bahnhofstrasse (rua de compras)",
                        "Museu Nacional Su√≠√ßo",
                        "Grossm√ºnster",
                        "Passeio pelo distrito financeiro"
                    ],
                    accommodation: {
                        name: "Youth Hostel Zurich",
                        cost: 200,
                        bookingUrl: "https://www.youthhostel.ch"
                    }
                },
                amsterdam: {
                    name: "Amsterdam",
                    coordinates: { lat: 52.3676, lng: 4.9041 },
                    dates: "22/04 - 23/04",
                    transport: {
                        from: "Zurich",
                        options: [
                            {
                                type: "voo",
                                company: "KLM/Swiss/EasyJet",
                                duration: "1h40",
                                cost: 100,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Melhor op√ß√£o considerando dist√¢ncia",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "trem",
                                company: "Conex√µes via Alemanha",
                                duration: "8h-9h",
                                cost: 150,
                                bookingUrl: "https://www.raileurope.com",
                                notes: "Paisagens da Alemanha/Holanda",
                                recommended: false
                            },
                            {
                                type: "onibus",
                                company: "FlixBus",
                                duration: "11-13h",
                                cost: 60,
                                bookingUrl: "https://www.flixbus.com",
                                notes: "Op√ß√£o noturna poss√≠vel",
                                recommended: false,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "Keukenhof (Jardim de Tulipas: 19‚Ç¨)",
                        "Passeio de barco pelos canais",
                        "Museu Van Gogh",
                        "Casa de Anne Frank",
                        "Vondelpark"
                    ],
                    accommodation: {
                        name: "Flying Pig Downtown",
                        cost: 160,
                        bookingUrl: "https://www.flyingpig.nl"
                    }
                },
                porto: {
                    name: "Porto",
                    coordinates: { lat: 41.1579, lng: -8.6291 },
                    dates: "24/04",
                    transport: {
                        from: "Amsterdam",
                        options: [
                            {
                                type: "voo",
                                company: "TAP/Transavia/Ryanair",
                                duration: "3h",
                                cost: 120,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "√önica op√ß√£o vi√°vel para esta dist√¢ncia",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "trem-onibus",
                                company: "M√∫ltiplas conex√µes",
                                duration: "+30h",
                                cost: 200,
                                bookingUrl: "",
                                notes: "N√£o recomendado devido √† dist√¢ncia",
                                recommended: false
                            }
                        ]
                    },
                    activities: [
                        "Retirada de carro alugado (150‚Ç¨/3 dias)",
                        "Caves do Vinho do Porto",
                        "Livraria Lello",
                        "Torre dos Cl√©rigos",
                        "Ribeira"
                    ],
                    accommodation: {
                        name: "Yes! Porto Hostel",
                        cost: 30,
                        bookingUrl: "https://www.yesporto.com"
                    }
                },
                foztua: {
                    name: "Foz Tua",
                    coordinates: { lat: 41.2193, lng: -7.4265 },
                    dates: "24/04 (dia)",
                    activities: [
                        "Visita √† Barragem de Foz Tua",
                        "Regi√£o vin√≠cola do Douro",
                        "Paisagens classificadas UNESCO"
                    ],
                    transport: {
                        special: "Parte do percurso com carro alugado"
                    }
                },
                geres: {
                    name: "Ger√™s",
                    coordinates: { lat: 41.7186, lng: -8.1668 },
                    dates: "24/04 - 25/04",
                    activities: [
                        "Trilha Cascata do Arado",
                        "Ponte da Misarela",
                        "Miradouro da Pedra Bela",
                        "Lagoas naturais"
                    ],
                    accommodation: {
                        name: "Casa da Lage Guest House",
                        cost: 75,
                        bookingUrl: "https://www.booking.com"
                    },
                    transport: {
                        special: "Continua√ß√£o com carro alugado"
                    }
                },
                lisboa_final: {
                    name: "Lisboa (Partida)",
                    coordinates: { lat: 38.7223, lng: -9.1393 },
                    dates: "25/04 - 26/04",
                    transport: {
                        from: "Ger√™s",
                        options: [
                            {
                                type: "carro",
                                company: "Carro alugado (continua√ß√£o)",
                                duration: "4h30",
                                cost: 0, // J√° contabilizado no aluguel
                                bookingUrl: "",
                                notes: "Rota direta via autoestrada",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "onibus",
                                company: "Rede Expressos (com conex√£o)",
                                duration: "6h-7h",
                                cost: 35,
                                bookingUrl: "https://www.rede-expressos.pt",
                                notes: "Menos flex√≠vel, mas economiza combust√≠vel",
                                recommended: false,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "Passeio final por Lisboa",
                        "Jantar de despedida",
                        "Prepara√ß√£o para o voo",
                        "Retorno ao Brasil (26/04)"
                    ],
                    accommodation: {
                        name: "Hotel Lisboa Plaza",
                        cost: 90,
                        bookingUrl: "https://www.lisbonplazahotel.com"
                    }
                }
            },
            order: ['albufeira', 'madrid', 'valencia', 'geneva', 'zurich', 'amsterdam', 'porto', 'foztua', 'geres', 'lisboa_final']
        };

        let map;
        let activeMarker;
        let markers = {};
        let polylines = [];

        function updateMap() {
            // Limpar marcadores e linhas existentes
            clearMapElements();

            const routeCoordinates = [];

            itineraryData.order.forEach((cityId, index) => {
                const city = itineraryData.cities[cityId];
                const coords = city.coordinates;

                // Criar marcador
                const marker = L.marker([coords.lat, coords.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        iconSize: [12, 12]
                    })
                }).addTo(map);

                marker.bindPopup(`
                    <h3>${city.name}</h3>
                    <p>Data: ${city.dates}</p>
                `);

                marker.on('click', () => {
                    if (activeMarker) {
                        activeMarker.getElement().classList.remove('active');
                    }
                    marker.getElement().classList.add('active');
                    activeMarker = marker;
                    showCityInfo(cityId);
                });

                markers[cityId] = marker;
                routeCoordinates.push([coords.lat, coords.lng]);

                // Conectar com a pr√≥xima cidade
                if (index < itineraryData.order.length - 1) {
                    const nextCity = itineraryData.cities[itineraryData.order[index + 1]].coordinates;
                    const polyline = L.polyline([
                        [coords.lat, coords.lng],
                        [nextCity.lat, nextCity.lng]
                    ], {
                        color: '#3498db',
                        weight: 2,
                        opacity: 0.7,
                        dashArray: '5, 10'
                    }).addTo(map);
                    polylines.push(polyline);
                }
            });

            // Ajustar visualiza√ß√£o
            map.fitBounds(L.latLngBounds(routeCoordinates));
        }

        function clearMapElements() {
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            markers = {};
            polylines.forEach(polyline => map.removeLayer(polyline));
            polylines = [];
        }

        function showCityInfo(cityId) {
            const city = itineraryData.cities[cityId];
            if (!city) return;

            // Preparar HTML para as op√ß√µes de transporte
            let transportHtml = '';
            
            if (city.transport && city.transport.options) {
                transportHtml = `
                    <div class="info-section">
                        <h4>Transporte de ${city.transport.from} para ${city.name}:</h4>
                        <div class="transport-options">
                `;
                
                city.transport.options.forEach(option => {
                    const typeClass = `transport-${option.type.toLowerCase()}`;
                    const recommendedClass = option.recommended ? 'transport-recommended' : '';
                    const badgeHtml = option.badge ? `<span class="${option.badge}-badge">${option.badge === 'economia' ? 'Mais econ√¥mico' : (option.badge === 'conforto' ? 'Mais confort√°vel' : 'Mais r√°pido')}</span>` : '';
                    
                    transportHtml += `
                        <div class="transport-option ${typeClass}">
                            <h4>${getTransportTypeIcon(option.type)} ${option.type.toUpperCase()} ${badgeHtml}</h4>
                            <p><strong>Empresa:</strong> ${option.company}</p>
                            <p><strong>Dura√ß√£o:</strong> ${option.duration}</p>
                            <p><strong>Custo:</strong> ‚Ç¨${option.cost}</p>
                            ${option.notes ? `<p><strong>Notas:</strong> <span class="${recommendedClass}">${option.notes}</span></p>` : ''}
                            ${option.bookingUrl ? `<a href="${option.bookingUrl}" target="_blank" class="booking-button">Reservar</a>` : ''}
                        </div>
                    `;
                });
                
                transportHtml += `
                        </div>
                    </div>
                `;
            } else if (city.transport && city.transport.special) {
                transportHtml = `
                    <div class="info-section">
                        <h4>Transporte:</h4>
                        <p>${city.transport.special}</p>
                    </div>
                `;
            }

            const infoHtml = `
                <div class="city-info">
                    <h3>${city.name}</h3>
                    <div class="info-section">
                        <p><strong>Datas:</strong> ${city.dates}</p>
                    </div>
                    
                    ${transportHtml}
                    
                    <div class="info-section">
                        <h4>Atividades:</h4>
                        <ul>
                            ${city.activities.map(activity => `<li>${activity}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${city.accommodation ? `
                        <div class="info-section">
                            <h4>Hospedagem:</h4>
                            <p>${city.accommodation.name}</p>
                            <p><strong>Custo:</strong> ‚Ç¨${city.accommodation.cost}</p>
                            <a href="${city.accommodation.bookingUrl}" target="_blank" class="booking-button">Reservar Hospedagem</a>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('cityInfo').innerHTML = infoHtml;
        }

        function getTransportTypeIcon(type) {
            switch(type.toLowerCase()) {
                case 'trem':
                    return 'üöÜ';
                case 'onibus':
                    return 'üöå';
                case 'voo':
                    return '‚úàÔ∏è';
                case 'carro':
                    return 'üöó';
                case 'trem-onibus':
                    return 'üöÜ/üöå';
                default:
                    return 'üö¢';
            }
        }

        function showTab(tabName) {
            // Atualizar estado das abas
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });

            const mapView = document.getElementById('mapView');
            const fullItinerary = document.getElementById('fullItinerary');

            // Atualizar visibilidade das se√ß√µes
            switch(tabName) {
                case 'map':
                    mapView.style.display = 'flex';
                    fullItinerary.style.display = 'none';
                    break;
                    
                case 'full-itinerary':
                    mapView.style.display = 'none';
                    fullItinerary.style.display = 'block';
                    showFullItinerary(); // Mostrar roteiro completo
                    break;
                    
                case 'summary':
                    mapView.style.display = 'none';
                    fullItinerary.style.display = 'block';
                    showFinancialSummary(); // Mostrar resumo financeiro
                    break;
            }
        }

        function showFullItinerary() {
            let itineraryHtml = '';
            
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                
                // Preparar HTML para as op√ß√µes de transporte
                let transportHtml = '';
                
                if (city.transport && city.transport.options) {
                    transportHtml = `
                        <div class="info-section">
                            <h4>Transporte de ${city.transport.from} para ${city.name}:</h4>
                            <div class="transport-options">
                    `;
                    
                    // Encontrar a op√ß√£o recomendada
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    
                    if (recommendedOption) {
                        const typeClass = `transport-${recommendedOption.type.toLowerCase()}`;
                        const badgeHtml = recommendedOption.badge ? `<span class="${recommendedOption.badge}-badge">${recommendedOption.badge === 'economia' ? 'Mais econ√¥mico' : (recommendedOption.badge === 'conforto' ? 'Mais confort√°vel' : 'Mais r√°pido')}</span>` : '';
                        
                        transportHtml += `
                            <div class="transport-option ${typeClass}">
                                <h4>${getTransportTypeIcon(recommendedOption.type)} ${recommendedOption.type.toUpperCase()} ${badgeHtml}</h4>
                                <p><strong>Empresa:</strong> ${recommendedOption.company}</p>
                                <p><strong>Dura√ß√£o:</strong> ${recommendedOption.duration}</p>
                                <p><strong>Custo:</strong> ‚Ç¨${recommendedOption.cost}</p>
                                ${recommendedOption.notes ? `<p><strong>Notas:</strong> <span class="transport-recommended">${recommendedOption.notes}</span></p>` : ''}
                                ${recommendedOption.bookingUrl ? `<a href="${recommendedOption.bookingUrl}" target="_blank" class="booking-button">Reservar</a>` : ''}
                            </div>
                        `;
                    }
                    
                    transportHtml += `
                            </div>
                            <p><small>Para ver todas as op√ß√µes de transporte, clique na cidade no mapa.</small></p>
                        </div>
                    `;
                } else if (city.transport && city.transport.special) {
                    transportHtml = `
                        <div class="info-section">
                            <h4>Transporte:</h4>
                            <p>${city.transport.special}</p>
                        </div>
                    `;
                }
                
                itineraryHtml += `
                    <div class="itinerary-day">
                        <h3>${city.name} - ${city.dates}</h3>
                        
                        ${transportHtml}
                        
                        <div class="info-section">
                            <h4>Atividades:</h4>
                            <ul>
                                ${city.activities.map(activity => `<li>${activity}</li>`).join('')}
                            </ul>
                        </div>
                        
                        ${city.accommodation ? `
                            <div class="info-section">
                                <h4>Hospedagem:</h4>
                                <p>${city.accommodation.name} - ‚Ç¨${city.accommodation.cost}</p>
                                <a href="${city.accommodation.bookingUrl}" target="_blank" class="booking-button">Reservar</a>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            // Calcular custos para o roteiro atual
            const costs = calculateTotalCosts();
            const totalBudget = 2000; // Or√ßamento definido
            // Ajuste: remover custo da hospedagem em Albufeira que j√° est√° confirmada
            costs.totalCost -= 0; // Antes era 90, agora √© 0
            const budgetRemaining = totalBudget - costs.totalCost;
            const budgetPercentage = (costs.totalCost / totalBudget) * 100;
            
            const budgetClass = budgetRemaining >= 0 ? 'budget-within' : 'budget-over';
            const budgetOverviewClass = budgetRemaining >= 0 ? '' : 'over-budget';
            
            document.getElementById('fullItinerary').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">Roteiro Lua de Mel 2025</h2>
                
                <div class="budget-overview ${budgetOverviewClass}">
                    <h3>Or√ßamento: ‚Ç¨${totalBudget}</h3>
                    <div class="budget-meter">
                        <div class="budget-fill ${budgetClass}" style="width: ${Math.min(budgetPercentage, 100)}%;"></div>
                    </div>
                    <p><strong>Custo Estimado:</strong> ‚Ç¨${costs.totalCost}</p>
                    <p><strong>${budgetRemaining >= 0 ? 'Saldo Restante' : 'Excedente'}: </strong> 
                       ‚Ç¨${Math.abs(budgetRemaining).toFixed(2)} ${budgetRemaining >= 0 ? '‚úÖ' : '‚ùå'}</p>
                </div>
                
                ${itineraryHtml}
                
                <div class="cost-summary">
                    <h3>Resumo Financeiro</h3>
                    <div class="cost-item">
                        <span>Transportes:</span>
                        <span>‚Ç¨${costs.transport}</span>
                    </div>
                    <div class="cost-item">
                        <span>Hospedagem:</span>
                        <span>‚Ç¨${costs.accommodation}</span>
                    </div>
                    <div class="cost-item">
                        <span>Alimenta√ß√£o:</span>
                        <span>‚Ç¨${costs.food}</span>
                    </div>
                    <div class="cost-item">
                        <span>Atra√ß√µes:</span>
                        <span>‚Ç¨${costs.attractions}</span>
                    </div>
                    <div class="cost-item">
                        <span>Extras:</span>
                        <span>‚Ç¨${costs.extras}</span>
                    </div>
                    <div class="total-cost">
                        <span>Total:</span>
                        <span>‚Ç¨${costs.totalCost}</span>
                    </div>
                </div>
            `;
        }

        function calculateTotalCosts() {
            let transportCost = 0;
            let accommodationCost = 0;
            const totalDays = 15; // N√∫mero de dias da viagem
            
            // Calcular custos de transporte
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                if (city.transport && city.transport.options) {
                    // Encontrar a op√ß√£o recomendada
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    if (recommendedOption) {
                        transportCost += recommendedOption.cost;
                    }
                }
            });
            
            // Adicionar o custo do aluguel de carro (j√° presente nas atividades do Porto)
            transportCost += 150; // 150‚Ç¨ para 3 dias de aluguel
            
            // Calcular custos de hospedagem
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                if (city.accommodation) {
                    // Adicionar apenas hospedagens que precisam ser pagas
                    accommodationCost += city.accommodation.cost;
                }
            });
            
            // Estimativas para alimenta√ß√£o, atra√ß√µes e extras
            const foodCost = totalDays * 35; // 35‚Ç¨ por dia
            const attractionsCost = 250; // Oceanogr√°fico, Bernab√©u, Keukenhof, etc.
            const extrasCost = totalDays * 10; // 10‚Ç¨ por dia
            
            // Custo total
            const totalCost = transportCost + accommodationCost + foodCost + attractionsCost + extrasCost;
            
            return {
                transport: transportCost,
                accommodation: accommodationCost,
                food: foodCost,
                attractions: attractionsCost,
                extras: extrasCost,
                totalCost: totalCost
            };
        }

        function showFinancialSummary() {
            const costs = calculateTotalCosts();
            const totalBudget = 2000; // Or√ßamento definido
            
            // Dados para gr√°ficos
            const categoryLabels = ['Transportes', 'Hospedagem', 'Alimenta√ß√£o', 'Atra√ß√µes', 'Extras'];
            const categoryData = [costs.transport, costs.accommodation, costs.food, costs.attractions, costs.extras];
            const categoryColors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
            
            // Dados para gr√°fico de cidades
            const cityCosts = [];
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                let cityTotal = 0;
                
                // Adicionar custo de hospedagem
                if (city.accommodation) {
                    cityTotal += city.accommodation.cost;
                }
                
                // Adicionar custo de transporte
                if (city.transport && city.transport.options) {
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    if (recommendedOption) {
                        cityTotal += recommendedOption.cost;
                    }
                }
                
                // Adicionar estimativa de gasto di√°rio
                const dailyCost = cityId === 'porto' ? 45 + 150 : 45; // Porto inclui aluguel do carro
                cityTotal += dailyCost;
                
                cityCosts.push({
                    name: city.name,
                    cost: cityTotal
                });
            });
            
            // Preparar resumo por cidade
            const citySummaryHtml = cityCosts.map(city => `
                <div class="cost-item">
                    <span>${city.name}:</span>
                    <span>‚Ç¨${city.cost.toFixed(2)}</span>
                </div>
            `).join('');
            
            // Verificar se o or√ßamento √© suficiente
            const budgetRemaining = totalBudget - costs.totalCost;
            const budgetPercentage = (costs.totalCost / totalBudget) * 100;
            const budgetClass = budgetRemaining >= 0 ? 'budget-within' : 'budget-over';
            const budgetOverviewClass = budgetRemaining >= 0 ? '' : 'over-budget';
            
            document.getElementById('fullItinerary').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">Resumo Financeiro - Lua de Mel 2025</h2>
                
                <div class="budget-overview ${budgetOverviewClass}">
                    <h3>Or√ßamento: ‚Ç¨${totalBudget}</h3>
                    <div class="budget-meter">
                        <div class="budget-fill ${budgetClass}" style="width: ${Math.min(budgetPercentage, 100)}%;"></div>
                    </div>
                    <p><strong>Custo Estimado:</strong> ‚Ç¨${costs.totalCost.toFixed(2)}</p>
                    <p><strong>${budgetRemaining >= 0 ? 'Saldo Restante' : 'Excedente'}: </strong> 
                       ‚Ç¨${Math.abs(budgetRemaining).toFixed(2)} ${budgetRemaining >= 0 ? '‚úÖ' : '‚ùå'}</p>
                </div>
                
                <div class="cost-charts">
                    <div class="chart-container">
                        <h3>Distribui√ß√£o de Custos por Categoria</h3>
                        <canvas id="categoriesChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Custo por Cidade</h3>
                        <canvas id="citiesChart"></canvas>
                    </div>
                </div>
                
                <div class="city-info">
                    <h3>Resumo de Custos por Categoria</h3>
                    <div class="cost-item">
                        <span>Transportes:</span>
                        <span>‚Ç¨${costs.transport.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Hospedagem:</span>
                        <span>‚Ç¨${costs.accommodation.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Alimenta√ß√£o:</span>
                        <span>‚Ç¨${costs.food.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Atra√ß√µes:</span>
                        <span>‚Ç¨${costs.attractions.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Extras:</span>
                        <span>‚Ç¨${costs.extras.toFixed(2)}</span>
                    </div>
                    <div class="total-cost">
                        <span>Total:</span>
                        <span>‚Ç¨${costs.totalCost.toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="city-info">
                    <h3>Resumo de Custos por Cidade</h3>
                    ${citySummaryHtml}
                </div>
                
                <div class="city-info">
                    <h3>Dicas para Economia</h3>
                    <ul>
                        <li>Reserve voos e hospedagens com anteced√™ncia para melhores pre√ßos</li>
                        <li>Considere passes de transporte p√∫blico nas cidades para economizar</li>
                        <li>Nos pa√≠ses mais caros (Su√≠√ßa, Holanda), tente preparar algumas refei√ß√µes</li>
                        <li>Busque city passes para museus e atra√ß√µes</li>
                        <li>Evite taxas de c√¢mbio ruins usando cart√µes sem taxas internacionais</li>
                    </ul>
                </div>
            `;
            
            // Criar gr√°ficos ap√≥s o HTML estar pronto
            setTimeout(() => {
                createCategoryChart(categoryLabels, categoryData, categoryColors);
                createCityChart(cityCosts);
            }, 100);
        }

        function createCategoryChart(labels, data, colors) {
            const ctx = document.getElementById('categoriesChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = Math.round((value / context.dataset.data.reduce((a, b) => a + b, 0)) * 100);
                                    return `${label}: ‚Ç¨${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createCityChart(cityCosts) {
            const ctx = document.getElementById('citiesChart').getContext('2d');
            const cityNames = cityCosts.map(city => city.name.split(' ')[0]); // Primeiro nome apenas para legibilidade
            const cityValues = cityCosts.map(city => city.cost);
            const backgroundColors = cityCosts.map((_, index) => {
                const hue = (index * 30) % 360;
                return `hsl(${hue}, 70%, 60%)`;
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cityNames,
                    datasets: [{
                        label: 'Custo por Cidade (‚Ç¨)',
                        data: cityValues,
                        backgroundColor: backgroundColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Custo (‚Ç¨)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Inicializar o mapa quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se a biblioteca Leaflet foi carregada
            function initMap() {
                if (typeof L !== 'undefined') {
                    map = L.map('map').setView([45.0, 10.0], 5);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(map);
                    updateMap();
                } else {
                    // Se o Leaflet ainda n√£o estiver carregado, tente novamente em 100ms
                    setTimeout(initMap, 100);
                }
            }
            
            initMap();
        });
    </script>
</body>
</html>
