<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
    <title>Roteiro Final: Porto 23/04-24/04 (com pernoite)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .content-wrapper {
            display: flex;
            gap: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background-color: #e9ecef;
        }

        .tab-button.active {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }

        /* Estilos do Container do Mapa */
        .map-container {
            width: 70%;
            position: relative;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f8f9fa;
            aspect-ratio: 4/3;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Estilos dos Marcadores e Popups do Leaflet */
        .leaflet-popup-content {
            font-size: 14px;
            line-height: 1.4;
            padding: 8px;
        }

        .leaflet-popup-content h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 3px;
        }

        .custom-marker {
            background-color: #e74c3c;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
        }

        .custom-marker:hover {
            background-color: #c0392b;
            transform: scale(1.2);
        }

        .custom-marker.active {
            background-color: #2ecc71;
            box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.3);
        }

        /* Painel de Informa√ß√µes */
        .info-panel {
            width: 30%;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 800px;
            overflow-y: auto;
        }

        .city-info {
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .city-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .info-section {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .booking-button {
            display: inline-block;
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .booking-button:hover {
            background-color: #2980b9;
        }

        /* Estilos do Itiner√°rio */
        .itinerary-day {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .itinerary-day h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .full-itinerary {
            display: none;
            padding: 20px;
        }

        /* Estilos do Resumo de Custos */
        .cost-summary {
            background-color: #f1f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .cost-summary h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px dashed #ccc;
        }

        .total-cost {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #3498db;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Estilos para as op√ß√µes de transporte */
        .transport-options {
            margin-top: 10px;
        }

        .transport-option {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }

        .transport-train {
            border-left-color: #2ecc71;
        }

        .transport-bus {
            border-left-color: #f39c12;
        }

        .transport-flight {
            border-left-color: #9b59b6;
        }

        .transport-car {
            border-left-color: #e74c3c;
        }

        .transport-option h4 {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .transport-option p {
            margin: 5px 0;
            font-size: 14px;
        }

        .economy-badge, .comfort-badge, .time-badge {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .economy-badge {
            background-color: #2ecc71;
            color: white;
        }

        .comfort-badge {
            background-color: #9b59b6;
            color: white;
        }

        .time-badge {
            background-color: #f39c12;
            color: white;
        }

        /* Resumo visual dos custos */
        .cost-charts {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        .chart-container {
            width: 45%;
            min-width: 300px;
            border-radius: 8px;
            background-color: white;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .map-container, .info-panel {
                width: 100%;
            }
            
            .map-container {
                height: 400px;
            }

            .chart-container {
                width: 100%;
            }
        }

        /* Estilos adicionados para transporte */
        .transport-recommended {
            font-weight: bold;
            color: #27ae60;
        }

        .budget-overview {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .budget-overview.over-budget {
            background-color: #e74c3c;
        }

        .budget-overview h3 {
            color: white;
            margin-bottom: 10px;
        }

        .budget-meter {
            height: 24px;
            background-color: #eee;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .budget-fill {
            height: 100%;
            background-color: #3498db;
            width: 0%; /* Ser√° ajustado com JavaScript */
            transition: width 1s ease-in-out;
        }

        .budget-over {
            background-color: #e74c3c;
        }

        .budget-within {
            background-color: #2ecc71;
        }

        /* Destaque para Tobog√£ */
        .highlight-attraction {
            background-color: #fef9e7;
            border-left: 4px solid #f1c40f;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .highlight-attraction h4 {
            color: #d35400;
            margin-bottom: 8px;
        }

        .highlight-attraction img {
            max-width: 100%;
            border-radius: 4px;
            margin: 10px 0;
        }

        /* Novo estilo para destacar os dias extras */
        .extra-day {
            background-color: #e8f8f5;
            border-left: 4px solid #1abc9c;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .extra-day h4 {
            color: #16a085;
            margin-bottom: 8px;
        }

        /* Estilo para compara√ß√£o antes/depois */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th, 
        .comparison-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .comparison-table th {
            background-color: #f2f2f2;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .highlight-row {
            background-color: #e8f8f5 !important;
        }
        
        /* Estilo para destaque da Holanda */
        .holland-highlight {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .holland-highlight h4 {
            color: #2980b9;
            margin-bottom: 8px;
        }
        
        /* Estilo para Portugal */
        .portugal-highlight {
            background-color: #f2d7d5;
            border-left: 4px solid #c0392b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .portugal-highlight h4 {
            color: #922b21;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Roteiro Final Lua de Mel 2025</h1>
        
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="map" onclick="showTab('map')">Mapa</button>
            <button class="tab-button" data-tab="full-itinerary" onclick="showTab('full-itinerary')">Roteiro Completo</button>
            <button class="tab-button" data-tab="summary" onclick="showTab('summary')">Resumo Financeiro</button>
        </div>
        
        <div class="content-wrapper" id="mapView">
            <div class="map-container">
                <div id="map"></div>
            </div>
            <div class="info-panel" id="infoPanel">
                <div id="cityInfo">
                    Selecione uma cidade no mapa para ver detalhes
                </div>
            </div>
        </div>

        <div class="full-itinerary" id="fullItinerary"></div>
    </div>

    <script>
        const itineraryData = {
            cities: {
                albufeira: {
                    name: "Albufeira (Casamento)",
                    coordinates: { lat: 37.0891, lng: -8.2401 },
                    dates: "12/04 - 14/04",
                    activities: [
                        "Chegada a Albufeira (12/04)",
                        "Casamento (13/04)",
                        "Prepara√ß√£o para pr√≥ximo destino (14/04)"
                    ],
                    accommodation: {
                        name: "Hospedagem j√° confirmada",
                        cost: 0, // J√° pago/reservado
                        notes: "Hospedagem j√° confirmada para estas datas"
                    }
                },
                madrid: {
                    name: "Madrid (Passagem)",
                    coordinates: { lat: 40.4168, lng: -3.7038 },
                    dates: "14/04 (visita de dia)",
                    transport: {
                        from: "Albufeira",
                        options: [
                            {
                                type: "voo",
                                company: "Ryanair (Faro)",
                                duration: "1h45",
                                cost: 90,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Melhor op√ß√£o considerando tempo",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "onibus",
                                company: "ALSA",
                                duration: "10-12h",
                                cost: 65,
                                bookingUrl: "https://www.alsa.es",
                                notes: "Noturno poss√≠vel, mas compromete a visita ao Bernab√©u",
                                recommended: false,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "Est√°dio Santiago Bernab√©u (Tour: 25‚Ç¨)",
                        "Pra√ßa de Cibeles (gratuito)",
                        "Puerta del Sol (gratuito)",
                        "Tempo para almo√ßo t√≠pico espanhol"
                    ]
                },
                valencia: {
                    name: "Valencia",
                    coordinates: { lat: 39.4699, lng: -0.3763 },
                    dates: "14/04 - 16/04",
                    transport: {
                        from: "Madrid",
                        options: [
                            {
                                type: "trem",
                                company: "Renfe (AVE)",
                                duration: "1h40",
                                cost: 45,
                                bookingUrl: "https://www.renfe.com",
                                notes: "Trem de alta velocidade, muito confort√°vel (√∫ltimo trem do dia)",
                                recommended: true,
                                badge: "conforto"
                            },
                            {
                                type: "onibus",
                                company: "ALSA",
                                duration: "4h-4h30",
                                cost: 30,
                                bookingUrl: "https://www.alsa.es",
                                notes: "Mais econ√¥mico que o trem",
                                recommended: false,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "L'Oceanogr√†fic (combinado com Cidade das Artes e Ci√™ncias: 40‚Ç¨ em vez de 45‚Ç¨)",
                        "Centro hist√≥rico de Val√™ncia (passeio gratuito)",
                        "Mercado Central (gratuito)",
                        "Praia de Malvarrosa (gratuita)",
                        "Jardins do T√∫ria (antigo leito do rio, convertido em parque)"
                    ],
                    accommodation: {
                        name: "Red Nest Hostel (quarto compartilhado)",
                        cost: 90,
                        bookingUrl: "https://www.hostelworld.com",
                        notes: "Localiza√ß√£o central, cozinha para preparar refei√ß√µes (2 noites)"
                    }
                },
                geneva: {
                    name: "Geneva",
                    coordinates: { lat: 46.2044, lng: 6.1432 },
                    dates: "16/04 - 18/04",
                    transport: {
                        from: "Valencia",
                        options: [
                            {
                                type: "voo",
                                company: "EasyJet (direto, se dispon√≠vel)",
                                duration: "2h",
                                cost: 130,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Voo direto, melhor op√ß√£o se dispon√≠vel",
                                recommended: false,
                                badge: "tempo"
                            },
                            {
                                type: "voo",
                                company: "Conex√£o via Madrid",
                                duration: "4h-5h (incluindo conex√£o)",
                                cost: 110,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Op√ß√£o mais comum, usando Madrid como conex√£o",
                                recommended: true,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "Jet d'Eau (gratuito)",
                        "CERN (visita gratuita com reserva antecipada)",
                        "Passeio pelo lago Leman (gratuito)",
                        "Excurs√£o de um dia a Les Diablerets (veja abaixo)",
                        "Catedral de S√£o Pedro (entrada gratuita)",
                        "Pal√°cio das Na√ß√µes Unidas (tour: 15‚Ç¨)"
                    ],
                    accommodation: {
                        name: "Geneva Hostel (quarto compartilhado)",
                        cost: 140,
                        bookingUrl: "https://www.genevahostel.ch",
                        notes: "Inclui passe gratuito para transporte p√∫blico (2 noites)"
                    },
                    special: {
                        title: "Tobog√£ Alpino em Les Diablerets (Glacier 3000)",
                        description: "Uma das melhores experi√™ncias da Su√≠√ßa! O Alpine Coaster √© um dos maiores tobog√£s em trilhos da Europa, com 1000 metros de descida emocionante a velocidades de at√© 40 km/h. A pista serpenteante oferece vistas deslumbrantes das montanhas.",
                        details: [
                            "Localiza√ß√£o: Glacier 3000, pr√≥ximo a Les Diablerets (2h de Geneva)",
                            "Pre√ßo: 80‚Ç¨/pessoa (inclui transporte de ida e volta desde Geneva e telef√©rico para o topo)",
                            "Dura√ß√£o: Excurs√£o de dia inteiro (8h)",
                            "Melhor √©poca: Funciona de maio a outubro (verificar disponibilidade para abril)",
                            "Alternativa em caso de fechamento: Tobog√£ no Monte Pilatus (perto de Lucerna)"
                        ],
                        image: "https://sample-image-url.com/toboga-suica.jpg",
                        bookingUrl: "https://www.glacier3000.ch"
                    }
                },
                pilatus: {
                    name: "Monte Pilatus (Tobog√£)",
                    coordinates: { lat: 46.9794, lng: 8.2544 },
                    dates: "18/04",
                    transport: {
                        from: "Geneva",
                        options: [
                            {
                                type: "trem",
                                company: "SBB (via Lucerna)",
                                duration: "3h",
                                cost: 75,
                                bookingUrl: "https://www.sbb.ch",
                                notes: "Trem panor√¢mico com belas vistas",
                                recommended: true,
                                badge: "conforto"
                            }
                        ]
                    },
                    activities: [
                        "Rodelbahn - Maior tobog√£ de tren√≥ da Su√≠√ßa (12‚Ç¨/descida)",
                        "Telef√©rico panor√¢mico para o topo (45‚Ç¨ ida e volta)",
                        "Vistas deslumbrantes dos Alpes Su√≠√ßos (gratuito)",
                        "Caminhadas em trilhas panor√¢micas (gratuito)"
                    ],
                    special: {
                        title: "Rodelbahn - O Maior Tobog√£ em Trilhos da Su√≠√ßa",
                        description: "O tobog√£ alpino do Monte Pilatus √© uma experi√™ncia √∫nica e emocionante, onde voc√™ controla sua pr√≥pria velocidade descendo 1350 metros atrav√©s de curvas, t√∫neis e giros a velocidades de at√© 40km/h. √â considerado um dos mais longos e espetaculares da Su√≠√ßa.",
                        details: [
                            "Comprimento: 1350 metros de pura adrenalina",
                            "Localiza√ß√£o: Monte Pilatus, pr√≥ximo a Lucerna",
                            "Pre√ßo: 12‚Ç¨ por descida ou 30‚Ç¨ por 5 descidas",
                            "Altitude: Localizado a 1350m acima do n√≠vel do mar",
                            "Funcionamento: Dispon√≠vel de abril a novembro (clima permitindo)"
                        ],
                        image: "https://sample-image-url.com/toboga-pilatus.jpg",
                        bookingUrl: "https://www.pilatus.ch"
                    }
                },
                zurich: {
                    name: "Zurich",
                    coordinates: { lat: 47.3769, lng: 8.5417 },
                    dates: "18/04 - 21/04",
                    transport: {
                        from: "Pilatus",
                        options: [
                            {
                                type: "trem",
                                company: "SBB (via Lucerna)",
                                duration: "1h30",
                                cost: 40,
                                bookingUrl: "https://www.sbb.ch",
                                notes: "Conex√£o confort√°vel via Lucerna",
                                recommended: true,
                                badge: "tempo"
                            }
                        ]
                    },
                    activities: [
                        "Lago Zurich (passeio gratuito)",
                        "Bahnhofstrasse (vitrine-shopping gratuito)",
                        "Lindenhof (mirante gratuito)",
                        "Passeio pelo centro hist√≥rico (gratuito)",
                        "Excurs√£o a Lucerna (cidade pr√≥xima: trem 25‚Ç¨ ida e volta)",
                        "Passeio de barco pelo Lago Zurich (25‚Ç¨)",
                        "Uetliberg - Montanha de Zurich (transporte + trilha: 15‚Ç¨)"
                    ],
                    accommodation: {
                        name: "Zurich Youth Hostel (quarto compartilhado)",
                        cost: 225,
                        bookingUrl: "https://www.youthhostel.ch",
                        notes: "Inclui caf√© da manh√£, cozinha para preparar refei√ß√µes (3 noites)"
                    },
                    extraDay: {
                        title: "Dia Extra em Zurich (19-21/04)",
                        description: "Um dia adicional em Zurich permite explorar melhor a cidade e arredores, incluindo uma excurs√£o a Lucerna ou ao topo de Uetliberg para vistas panor√¢micas dos Alpes.",
                        activities: [
                            "Mais tempo para relaxar e explorar a cidade",
                            "Visita ao Museu Nacional Su√≠√ßo (10‚Ç¨)",
                            "Possibilidade de excurs√£o a Reno Falls, as maiores quedas d'√°gua da Europa (60‚Ç¨ ida e volta)"
                        ]
                    }
                },
                amsterdam: {
                    name: "Amsterdam",
                    coordinates: { lat: 52.3676, lng: 4.9041 },
                    dates: "21/04 - 23/04",
                    transport: {
                        from: "Zurich",
                        options: [
                            {
                                type: "voo",
                                company: "Swiss/KLM (direto)",
                                duration: "1h40",
                                cost: 110,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "V√°rias op√ß√µes de voos diretos por dia",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "trem",
                                company: "Conex√µes via Alemanha",
                                duration: "8h-9h",
                                cost: 150,
                                bookingUrl: "https://www.raileurope.com",
                                notes: "Longo mas com paisagens bonitas",
                                recommended: false
                            },
                            {
                                type: "onibus",
                                company: "FlixBus (noturno)",
                                duration: "11-13h",
                                cost: 50,
                                bookingUrl: "https://www.flixbus.com",
                                notes: "Op√ß√£o econ√¥mica, viagem noturna poupa uma di√°ria de hotel",
                                recommended: false,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "Keukenhof (Parque de Tulipas: 19‚Ç¨ por pessoa)",
                        "Excurs√£o a Giethoorn (65‚Ç¨ incluindo transporte)",
                        "Passeio de barco pelos canais (15‚Ç¨)",
                        "Free Walking Tour pelo centro (gorjeta de 5-10‚Ç¨)",
                        "Vondelpark (gratuito)",
                        "Mercado de flores flutuante (gratuito para visitar)"
                    ],
                    accommodation: {
                        name: "ClinkNOORD Hostel (quarto compartilhado)",
                        cost: 120,
                        bookingUrl: "https://www.clinkhostels.com",
                        notes: "Cozinha compartilhada, ferry gratuito para o centro (2 noites)"
                    },
                    special: {
                        title: "Giethoorn - A Veneza do Norte",
                        description: "Uma vila encantadora nos Pa√≠ses Baixos conhecida por seus canais, pontes e aus√™ncia quase total de ruas. Quase todos os deslocamentos s√£o feitos de barco ou a p√© atrav√©s de pequenas pontes que cruzam os canais.",
                        details: [
                            "Excurs√£o de dia inteiro saindo de Amsterdam",
                            "Inclui passeio de barco pelos canais da vila (1 hora)",
                            "Tempo livre para explorar, almo√ßar e fotografar",
                            "Uma das vilas mais fotog√™nicas da Europa",
                            "Pre√ßo: 65‚Ç¨ por pessoa para excurs√£o organizada com transporte"
                        ],
                        image: "https://sample-image-url.com/giethoorn.jpg",
                        bookingUrl: "https://www.getyourguide.com"
                    }
                },
                porto: {
                    name: "Porto",
                    coordinates: { lat: 41.1579, lng: -8.6291 },
                    dates: "23/04 - 24/04",
                    transport: {
                        from: "Amsterdam",
                        options: [
                            {
                                type: "voo",
                                company: "Transavia/TAP (direto)",
                                duration: "3h",
                                cost: 95,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Voo preferencialmente pela manh√£ para aproveitar o dia no Porto",
                                recommended: true,
                                badge: "tempo"
                            },
                            {
                                type: "voo",
                                company: "M√∫ltiplas companhias (com escala)",
                                duration: "5-6h",
                                cost: 85,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Op√ß√µes mais econ√¥micas geralmente t√™m escala",
                                recommended: false,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "Aluguel de carro econ√¥mico (120‚Ç¨/3 dias atrav√©s de agregadores como AutoEurope)",
                        "Caves do Vinho do Porto (algumas t√™m degusta√ß√£o gratuita/econ√¥mica)",
                        "Ribeira (passeio cl√°ssico)",
                        "Ponte Dom Lu√≠s I (gratuito)",
                        "Livraria Lello (entrada: 5‚Ç¨, dedut√≠vel na compra de livros)",
                        "Torre dos Cl√©rigos (subida: 6‚Ç¨)",
                        "Jantar na Ribeira com vista para o rio"
                    ],
                    accommodation: {
                        name: "Nice Way Porto Hostel (quarto compartilhado)",
                        cost: 50,
                        bookingUrl: "https://www.nicewayportohostel.com",
                        notes: "Localiza√ß√£o central, cozinha compartilhada (1 noite)"
                    }
                },
                foztua: {
                    name: "Foz Tua (a partir do Porto)",
                    coordinates: { lat: 41.2193, lng: -7.4265 },
                    dates: "24/04 (dia)",
                    activities: [
                        "Visita √† Barragem de Foz Tua",
                        "Regi√£o vin√≠cola do Douro",
                        "Paisagens classificadas UNESCO",
                        "Passeio de barco no rio Douro (opcional: 25‚Ç¨)"
                    ],
                    transport: {
                        special: "Parte do percurso com carro alugado (2h de carro do Porto)"
                    }
                },
                geres: {
                    name: "Ger√™s",
                    coordinates: { lat: 41.7186, lng: -8.1668 },
                    dates: "24/04 (noite) - 25/04",
                    activities: [
                        "Trilha Cascata do Arado (gratuita)",
                        "Ponte da Misarela (gratuita)",
                        "Miradouro da Pedra Bela (gratuito)",
                        "Lagoas naturais (gratuitas)",
                        "Piquenique na natureza (economia em refei√ß√µes)"
                    ],
                    accommodation: {
                        name: "Albergue de Campo (tipo rural)",
                        cost: 50,
                        bookingUrl: "https://www.booking.com",
                        notes: "Op√ß√£o com cozinha para preparar refei√ß√µes"
                    },
                    transport: {
                        special: "Continua√ß√£o com carro alugado (2h a partir de Foz Tua)"
                    }
                },
                lisboa_final: {
                    name: "Lisboa (Partida)",
                    coordinates: { lat: 38.7223, lng: -9.1393 },
                    dates: "26/04",
                    transport: {
                        from: "Ger√™s",
                        options: [
                            {
                                type: "carro",
                                company: "Carro alugado (continua√ß√£o)",
                                duration: "4h30",
                                cost: 0, // J√° contabilizado no aluguel
                                bookingUrl: "",
                                notes: "Sa√≠da cedo para chegar a Lisboa com tempo suficiente",
                                recommended: true,
                                badge: "tempo"
                            }
                        ]
                    },
                    activities: [
                        "Aeroporto de Lisboa para devolu√ß√£o do carro alugado",
                        "Tempo livre dependendo do hor√°rio do voo",
                        "Retorno ao Brasil (26/04)"
                    ]
                }
            },
            order: ['albufeira', 'madrid', 'valencia', 'geneva', 'pilatus', 'zurich', 'amsterdam', 'porto', 'foztua', 'geres', 'lisboa_final']
        };

        let map;
        let activeMarker;
        let markers = {};
        let polylines = [];

        function updateMap() {
            // Limpar marcadores e linhas existentes
            clearMapElements();

            const routeCoordinates = [];

            itineraryData.order.forEach((cityId, index) => {
                const city = itineraryData.cities[cityId];
                const coords = city.coordinates;

                // Criar marcador
                const marker = L.marker([coords.lat, coords.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        iconSize: [12, 12]
                    })
                }).addTo(map);

                marker.bindPopup(`
                    <h3>${city.name}</h3>
                    <p>Data: ${city.dates}</p>
                `);

                marker.on('click', () => {
                    if (activeMarker) {
                        activeMarker.getElement().classList.remove('active');
                    }
                    marker.getElement().classList.add('active');
                    activeMarker = marker;
                    showCityInfo(cityId);
                });

                markers[cityId] = marker;
                routeCoordinates.push([coords.lat, coords.lng]);

                // Conectar com a pr√≥xima cidade
                if (index < itineraryData.order.length - 1) {
                    const nextCity = itineraryData.cities[itineraryData.order[index + 1]].coordinates;
                    const polyline = L.polyline([
                        [coords.lat, coords.lng],
                        [nextCity.lat, nextCity.lng]
                    ], {
                        color: '#3498db',
                        weight: 2,
                        opacity: 0.7,
                        dashArray: '5, 10'
                    }).addTo(map);
                    polylines.push(polyline);
                }
            });

            // Ajustar visualiza√ß√£o
            map.fitBounds(L.latLngBounds(routeCoordinates));
        }

        function clearMapElements() {
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            markers = {};
            polylines.forEach(polyline => map.removeLayer(polyline));
            polylines = [];
        }

        function showCityInfo(cityId) {
            const city = itineraryData.cities[cityId];
            if (!city) return;

            // Preparar HTML para as op√ß√µes de transporte
            let transportHtml = '';
            
            if (city.transport && city.transport.options) {
                transportHtml = `
                    <div class="info-section">
                        <h4>Transporte de ${city.transport.from} para ${city.name}:</h4>
                        <div class="transport-options">
                `;
                
                city.transport.options.forEach(option => {
                    const typeClass = `transport-${option.type.toLowerCase()}`;
                    const recommendedClass = option.recommended ? 'transport-recommended' : '';
                    const badgeHtml = option.badge ? `<span class="${option.badge}-badge">${option.badge === 'economia' ? 'Mais econ√¥mico' : (option.badge === 'conforto' ? 'Mais confort√°vel' : 'Mais r√°pido')}</span>` : '';
                    
                    transportHtml += `
                        <div class="transport-option ${typeClass}">
                            <h4>${getTransportTypeIcon(option.type)} ${option.type.toUpperCase()} ${badgeHtml}</h4>
                            <p><strong>Empresa:</strong> ${option.company}</p>
                            <p><strong>Dura√ß√£o:</strong> ${option.duration}</p>
                            <p><strong>Custo:</strong> ‚Ç¨${option.cost}</p>
                            ${option.notes ? `<p><strong>Notas:</strong> <span class="${recommendedClass}">${option.notes}</span></p>` : ''}
                            ${option.bookingUrl ? `<a href="${option.bookingUrl}" target="_blank" class="booking-button">Reservar</a>` : ''}
                        </div>
                    `;
                });
                
                transportHtml += `
                        </div>
                    </div>
                `;
            } else if (city.transport && city.transport.special) {
                transportHtml = `
                    <div class="info-section">
                        <h4>Transporte:</h4>
                        <p>${city.transport.special}</p>
                    </div>
                `;
            }

            // Adicionar informa√ß√µes especiais (como tobog√£ ou Giethoorn)
            let specialHtml = '';
            if (city.special) {
                let specialClass = 'highlight-attraction';
                if (city.name.includes('Amsterdam')) {
                    specialClass = 'holland-highlight';
                }
                
                specialHtml = `
                    <div class="${specialClass}">
                        <h4>${city.special.title}</h4>
                        <p>${city.special.description}</p>
                        <ul>
                            ${city.special.details.map(detail => `<li>${detail}</li>`).join('')}
                        </ul>
                        <a href="${city.special.bookingUrl}" target="_blank" class="booking-button">Verificar Disponibilidade</a>
                    </div>
                `;
            }
            
            // Adicionar informa√ß√µes sobre o dia extra
            let extraDayHtml = '';
            if (city.extraDay) {
                extraDayHtml = `
                    <div class="extra-day">
                        <h4>${city.extraDay.title}</h4>
                        <p>${city.extraDay.description}</p>
                        <ul>
                            ${city.extraDay.activities.map(activity => `<li>${activity}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Adicionar destaque para Portugal
            let portugalHtml = '';
            if (city.name.includes('Porto') || city.name.includes('Ger√™s') || city.name.includes('Foz Tua')) {
                portugalHtml = `
                    <div class="portugal-highlight">
                        <h4>Roteiro em Portugal</h4>
                        <p>Conforme solicitado, o roteiro em Portugal inclui:</p>
                        <ul>
                            <li><strong>23/04-24/04:</strong> Pernoite em Porto - tempo para explorar a cidade</li>
                            <li><strong>24/04:</strong> Visita a Foz Tua durante o dia ‚Üí Viagem para Ger√™s</li>
                            <li><strong>25/04:</strong> Dia completo em Ger√™s</li>
                            <li><strong>26/04:</strong> Viagem para Lisboa apenas para pegar o voo de retorno</li>
                        </ul>
                        <p>Este formato otimizado permite aproveitar os pontos principais de Portugal enquanto maximiza o tempo na Su√≠√ßa e Holanda.</p>
                    </div>
                `;
            }

            const infoHtml = `
                <div class="city-info">
                    <h3>${city.name}</h3>
                    <div class="info-section">
                        <p><strong>Datas:</strong> ${city.dates}</p>
                    </div>
                    
                    ${transportHtml}
                    
                    <div class="info-section">
                        <h4>Atividades:</h4>
                        <ul>
                            ${city.activities.map(activity => `<li>${activity}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${extraDayHtml}
                    
                    ${specialHtml}
                    
                    ${portugalHtml}
                    
                    ${city.accommodation ? `
                        <div class="info-section">
                            <h4>Hospedagem:</h4>
                            <p>${city.accommodation.name}</p>
                            <p><strong>Custo:</strong> ‚Ç¨${city.accommodation.cost}</p>
                            ${city.accommodation.notes ? `<p><small>${city.accommodation.notes}</small></p>` : ''}
                            <a href="${city.accommodation.bookingUrl}" target="_blank" class="booking-button">Reservar Hospedagem</a>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('cityInfo').innerHTML = infoHtml;
        }

        function getTransportTypeIcon(type) {
            switch(type.toLowerCase()) {
                case 'trem':
                    return 'üöÜ';
                case 'onibus':
                    return 'üöå';
                case 'voo':
                    return '‚úàÔ∏è';
                case 'carro':
                    return 'üöó';
                case 'trem-onibus':
                    return 'üöÜ/üöå';
                default:
                    return 'üö¢';
            }
        }

        function showTab(tabName) {
            // Atualizar estado das abas
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });

            const mapView = document.getElementById('mapView');
            const fullItinerary = document.getElementById('fullItinerary');

            // Atualizar visibilidade das se√ß√µes
            switch(tabName) {
                case 'map':
                    mapView.style.display = 'flex';
                    fullItinerary.style.display = 'none';
                    break;
                    
                case 'full-itinerary':
                    mapView.style.display = 'none';
                    fullItinerary.style.display = 'block';
                    showFullItinerary(); // Mostrar roteiro completo
                    break;
                    
                case 'summary':
                    mapView.style.display = 'none';
                    fullItinerary.style.display = 'block';
                    showFinancialSummary(); // Mostrar resumo financeiro
                    break;
            }
        }

        function showFullItinerary() {
            let itineraryHtml = '';
            
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                
                // Preparar HTML para as op√ß√µes de transporte
                let transportHtml = '';
                
                if (city.transport && city.transport.options) {
                    transportHtml = `
                        <div class="info-section">
                            <h4>Transporte de ${city.transport.from} para ${city.name}:</h4>
                            <div class="transport-options">
                    `;
                    
                    // Encontrar a op√ß√£o recomendada
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    
                    if (recommendedOption) {
                        const typeClass = `transport-${recommendedOption.type.toLowerCase()}`;
                        const badgeHtml = recommendedOption.badge ? `<span class="${recommendedOption.badge}-badge">${recommendedOption.badge === 'economia' ? 'Mais econ√¥mico' : (recommendedOption.badge === 'conforto' ? 'Mais confort√°vel' : 'Mais r√°pido')}</span>` : '';
                        
                        transportHtml += `
                            <div class="transport-option ${typeClass}">
                                <h4>${getTransportTypeIcon(recommendedOption.type)} ${recommendedOption.type.toUpperCase()} ${badgeHtml}</h4>
                                <p><strong>Empresa:</strong> ${recommendedOption.company}</p>
                                <p><strong>Dura√ß√£o:</strong> ${recommendedOption.duration}</p>
                                <p><strong>Custo:</strong> ‚Ç¨${recommendedOption.cost}</p>
                                ${recommendedOption.notes ? `<p><strong>Notas:</strong> <span class="transport-recommended">${recommendedOption.notes}</span></p>` : ''}
                                ${recommendedOption.bookingUrl ? `<a href="${recommendedOption.bookingUrl}" target="_blank" class="booking-button">Reservar</a>` : ''}
                            </div>
                        `;
                    }
                    
                    transportHtml += `
                            </div>
                            <p><small>Para ver todas as op√ß√µes de transporte, clique na cidade no mapa.</small></p>
                        </div>
                    `;
                } else if (city.transport && city.transport.special) {
                    transportHtml = `
                        <div class="info-section">
                            <h4>Transporte:</h4>
                            <p>${city.transport.special}</p>
                        </div>
                    `;
                }

                // Adicionar informa√ß√µes especiais (como tobog√£ ou Giethoorn)
                let specialHtml = '';
                if (city.special) {
                    let specialClass = 'highlight-attraction';
                    if (city.name.includes('Amsterdam')) {
                        specialClass = 'holland-highlight';
                    }
                    
                    specialHtml = `
                        <div class="${specialClass}">
                            <h4>${city.special.title}</h4>
                            <p>${city.special.description}</p>
                            <ul>
                                ${city.special.details.map(detail => `<li>${detail}</li>`).join('')}
                            </ul>
                            <a href="${city.special.bookingUrl}" target="_blank" class="booking-button">Verificar Disponibilidade</a>
                        </div>
                    `;
                }
                
                // Adicionar informa√ß√µes sobre o dia extra
                let extraDayHtml = '';
                if (city.extraDay) {
                    extraDayHtml = `
                        <div class="extra-day">
                            <h4>${city.extraDay.title}</h4>
                            <p>${city.extraDay.description}</p>
                            <ul>
                                ${city.extraDay.activities.map(activity => `<li>${activity}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                // Adicionar destaque para Portugal
                let portugalHtml = '';
                if (city.name.includes('Porto') || city.name.includes('Ger√™s') || city.name.includes('Foz Tua')) {
                    portugalHtml = `
                        <div class="portugal-highlight">
                            <h4>Roteiro em Portugal</h4>
                            <p>Conforme solicitado, o roteiro em Portugal inclui:</p>
                            <ul>
                                <li><strong>23/04-24/04:</strong> Pernoite em Porto - tempo para explorar a cidade</li>
                                <li><strong>24/04:</strong> Visita a Foz Tua durante o dia ‚Üí Viagem para Ger√™s</li>
                                <li><strong>25/04:</strong> Dia completo em Ger√™s</li>
                                <li><strong>26/04:</strong> Viagem para Lisboa apenas para pegar o voo de retorno</li>
                            </ul>
                            <p>Este formato otimizado permite aproveitar os pontos principais de Portugal enquanto maximiza o tempo na Su√≠√ßa e Holanda.</p>
                        </div>
                    `;
                }
                
                itineraryHtml += `
                    <div class="itinerary-day">
                        <h3>${city.name} - ${city.dates}</h3>
                        
                        ${transportHtml}
                        
                        <div class="info-section">
                            <h4>Atividades:</h4>
                            <ul>
                                ${city.activities.map(activity => `<li>${activity}</li>`).join('')}
                            </ul>
                        </div>
                        
                        ${extraDayHtml}
                        
                        ${specialHtml}
                        
                        ${portugalHtml}
                        
                        ${city.accommodation ? `
                            <div class="info-section">
                                <h4>Hospedagem:</h4>
                                <p>${city.accommodation.name} - ‚Ç¨${city.accommodation.cost}</p>
                                ${city.accommodation.notes ? `<p><small>${city.accommodation.notes}</small></p>` : ''}
                                <a href="${city.accommodation.bookingUrl}" target="_blank" class="booking-button">Reservar</a>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            // Resumo das mudan√ßas do roteiro
            const roteiroDiff = `
                <div class="portugal-highlight">
                    <h4>Roteiro Final: Pernoite em Porto</h4>
                    <p>O roteiro foi ajustado para incluir uma noite em Porto (23/04 para 24/04) conforme solicitado.</p>
                    
                    <h5 style="margin-top: 15px; margin-bottom: 8px;">Cronograma Final:</h5>
                    <ul>
                        <li><strong>12-14/04:</strong> Albufeira (Casamento)</li>
                        <li><strong>14/04:</strong> Madrid (apenas visita ao Bernab√©u)</li>
                        <li><strong>14-16/04:</strong> Valencia (2 noites)</li>
                        <li><strong>16-18/04:</strong> Geneva (2 noites, incluindo tobog√£)</li>
                        <li><strong>18-21/04:</strong> Zurich (3 noites)</li>
                        <li><strong>21-23/04:</strong> Amsterdam (2 noites, incluindo Keukenhof e Giethoorn)</li>
                        <li><strong>23-24/04:</strong> Porto (1 noite)</li>
                        <li><strong>24-25/04:</strong> Ger√™s (1 noite, com passagem por Foz Tua)</li>
                        <li><strong>26/04:</strong> Lisboa (apenas para pegar o voo)</li>
                    </ul>
                    
                    <p style="margin-top: 15px;"><strong>Equil√≠brio do roteiro:</strong> Este roteiro final proporciona uma excelente distribui√ß√£o de tempo entre Europa (Espanha, Su√≠√ßa e Holanda) e Portugal, garantindo que voc√™s possam visitar todos os pontos essenciais solicitados.</p>
                </div>
            `;
            
            // Calcular custos para o roteiro atual
            const costs = calculateTotalCosts();
            const totalBudget = 2000; // Or√ßamento definido por pessoa
            // Como √© um casal, multiplicamos o or√ßamento por 2
            const totalCouplesBudget = totalBudget * 2;
            const budgetRemaining = totalCouplesBudget - costs.totalCost;
            const budgetPercentage = (costs.totalCost / totalCouplesBudget) * 100;
            
            const budgetClass = budgetRemaining >= 0 ? 'budget-within' : 'budget-over';
            const budgetOverviewClass = budgetRemaining >= 0 ? '' : 'over-budget';
            
            document.getElementById('fullItinerary').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">Roteiro Final Lua de Mel 2025</h2>
                
                <div class="budget-overview ${budgetOverviewClass}">
                    <h3>Or√ßamento Total (Casal): ‚Ç¨${totalCouplesBudget}</h3>
                    <div class="budget-meter">
                        <div class="budget-fill ${budgetClass}" style="width: ${Math.min(budgetPercentage, 100)}%;"></div>
                    </div>
                    <p><strong>Custo Estimado:</strong> ‚Ç¨${costs.totalCost}</p>
                    <p><strong>${budgetRemaining >= 0 ? 'Saldo Restante' : 'Excedente'}: </strong> 
                       ‚Ç¨${Math.abs(budgetRemaining).toFixed(2)} ${budgetRemaining >= 0 ? '‚úÖ' : '‚ùå'}</p>
                </div>
                
                ${roteiroDiff}
                
                ${itineraryHtml}
                
                <div class="cost-summary">
                    <h3>Resumo Financeiro (Para o Casal)</h3>
                    <div class="cost-item">
                        <span>Transportes:</span>
                        <span>‚Ç¨${costs.transport}</span>
                    </div>
                    <div class="cost-item">
                        <span>Hospedagem:</span>
                        <span>‚Ç¨${costs.accommodation}</span>
                    </div>
                    <div class="cost-item">
                        <span>Alimenta√ß√£o:</span>
                        <span>‚Ç¨${costs.food}</span>
                    </div>
                    <div class="cost-item">
                        <span>Atra√ß√µes (incluindo Tobog√£ e Giethoorn):</span>
                        <span>‚Ç¨${costs.attractions}</span>
                    </div>
                    <div class="cost-item">
                        <span>Extras:</span>
                        <span>‚Ç¨${costs.extras}</span>
                    </div>
                    <div class="total-cost">
                        <span>Total para o Casal:</span>
                        <span>‚Ç¨${costs.totalCost}</span>
                    </div>
                    <div class="total-cost">
                        <span>Custo por Pessoa:</span>
                        <span>‚Ç¨${Math.round(costs.totalCost / 2)}</span>
                    </div>
                </div>
            `;
        }

        function calculateTotalCosts() {
            let transportCost = 0;
            let accommodationCost = 0;
            const totalDays = 15; // N√∫mero de dias da viagem
            
            // Calcular custos de transporte
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                if (city.transport && city.transport.options) {
                    // Encontrar a op√ß√£o recomendada para cada trecho
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    
                    if (recommendedOption) {
                        // Multiplicar por 2 para o casal
                        transportCost += recommendedOption.cost * 2;
                    }
                }
            });
            
            // Adicionar o custo do aluguel de carro
            transportCost += 120; // 120‚Ç¨ para 3 dias de aluguel (op√ß√£o econ√¥mica)
            
            // Calcular custos de hospedagem (j√° √© o pre√ßo do quarto para o casal)
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                if (city.accommodation) {
                    // Adicionar apenas hospedagens que precisam ser pagas
                    accommodationCost += city.accommodation.cost;
                }
            });
            
            // Estimativas para alimenta√ß√£o, atra√ß√µes e extras PARA DUAS PESSOAS
            const foodCostPerDay = 25; // 25‚Ç¨ por pessoa por dia (economizando)
            const foodCost = totalDays * foodCostPerDay * 2; // Para duas pessoas
            
            // Atra√ß√µes principais (para duas pessoas)
            const attractionsCost = 2 * (
                25 + // Bernab√©u
                40 + // Oceanogr√°fico 
                45 + // Tobog√£ Su√≠√ßo
                19 + // Keukenhof
                65 + // Giethoorn
                40   // Outras atra√ß√µes
            );
            
            const extrasCost = totalDays * 5 * 2; // 5‚Ç¨ por pessoa por dia (reduzido)
            
            // Custo total
            const totalCost = transportCost + accommodationCost + foodCost + attractionsCost + extrasCost;
            
            return {
                transport: Math.round(transportCost),
                accommodation: Math.round(accommodationCost),
                food: Math.round(foodCost),
                attractions: Math.round(attractionsCost),
                extras: Math.round(extrasCost),
                totalCost: Math.round(totalCost)
            };
        }

        function showFinancialSummary() {
            const costs = calculateTotalCosts();
            const totalBudget = 2000; // Or√ßamento definido por pessoa
            const totalCouplesBudget = totalBudget * 2;
            
            // Dados para gr√°ficos
            const categoryLabels = ['Transportes', 'Hospedagem', 'Alimenta√ß√£o', 'Atra√ß√µes', 'Extras'];
            const categoryData = [costs.transport, costs.accommodation, costs.food, costs.attractions, costs.extras];
            const categoryColors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
            
            // Dados para gr√°fico de cidades
            const cityCosts = [];
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                let cityTotal = 0;
                
                // Adicionar custo de hospedagem
                if (city.accommodation) {
                    cityTotal += city.accommodation.cost;
                }
                
                // Adicionar custo de transporte
                if (city.transport && city.transport.options) {
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    if (recommendedOption) {
                        cityTotal += recommendedOption.cost * 2; // Para o casal
                    }
                }
                
                // Adicionar estimativa de gasto di√°rio
                const dailyCost = cityId === 'porto' ? 45 * 2 + 120 : 45 * 2; // Porto inclui aluguel do carro, *2 para o casal
                cityTotal += dailyCost;
                
                // Adicionar custo de atra√ß√µes especiais
                if (city.name.includes("Madrid")) {
                    cityTotal += 25 * 2; // Bernab√©u
                } else if (city.name.includes("Valencia")) {
                    cityTotal += 40 * 2; // Oceanogr√°fico
                } else if (city.special && city.name.includes("Geneva") || city.name.includes("Pilatus")) {
                    cityTotal += 45 * 2; // Tobog√£
                } else if (city.name.includes("Amsterdam")) {
                    cityTotal += (19 + 65) * 2; // Keukenhof + Giethoorn
                }
                
                cityCosts.push({
                    name: city.name,
                    cost: cityTotal
                });
            });
            
            // Preparar resumo por cidade
            const citySummaryHtml = cityCosts.map(city => `
                <div class="cost-item">
                    <span>${city.name}:</span>
                    <span>‚Ç¨${city.cost.toFixed(2)}</span>
                </div>
            `).join('');
            
            // Verificar se o or√ßamento √© suficiente
            const budgetRemaining = totalCouplesBudget - costs.totalCost;
            const budgetPercentage = (costs.totalCost / totalCouplesBudget) * 100;
            const budgetClass = budgetRemaining >= 0 ? 'budget-within' : 'budget-over';
            const budgetOverviewClass = budgetRemaining >= 0 ? '' : 'over-budget';
            
            document.getElementById('fullItinerary').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">Resumo Financeiro - Roteiro Final</h2>
                
                <div class="budget-overview ${budgetOverviewClass}">
                    <h3>Or√ßamento Total (Casal): ‚Ç¨${totalCouplesBudget}</h3>
                    <div class="budget-meter">
                        <div class="budget-fill ${budgetClass}" style="width: ${Math.min(budgetPercentage, 100)}%;"></div>
                    </div>
                    <p><strong>Custo Estimado:</strong> ‚Ç¨${costs.totalCost.toFixed(2)}</p>
                    <p><strong>${budgetRemaining >= 0 ? 'Saldo Restante' : 'Excedente'}: </strong> 
                       ‚Ç¨${Math.abs(budgetRemaining).toFixed(2)} ${budgetRemaining >= 0 ? '‚úÖ' : '‚ùå'}</p>
                </div>
                
                <div class="portugal-highlight">
                    <h4>Distribui√ß√£o de Custos no Roteiro Final</h4>
                    <p>O roteiro final com pernoite em Porto tem a seguinte distribui√ß√£o de custos:</p>
                    
                    <table class="comparison-table">
                        <tr>
                            <th>Regi√£o</th>
                            <th>Dura√ß√£o</th>
                            <th>Custo Aproximado</th>
                            <th>Destaques</th>
                        </tr>
                        <tr>
                            <td>Espanha</td>
                            <td>2 noites</td>
                            <td>‚Ç¨400</td>
                            <td>Bernab√©u, Oceanogr√°fico</td>
                        </tr>
                        <tr>
                            <td>Su√≠√ßa</td>
                            <td>5 noites</td>
                            <td>‚Ç¨1.500</td>
                            <td>Tobog√£ alpino, Lucerna, Geneva</td>
                        </tr>
                        <tr>
                            <td>Holanda</td>
                            <td>2 noites</td>
                            <td>‚Ç¨600</td>
                            <td>Keukenhof, Giethoorn</td>
                        </tr>
                        <tr>
                            <td>Portugal</td>
                            <td>2 noites</td>
                            <td>‚Ç¨350</td>
                            <td>Porto, Foz Tua, Ger√™s</td>
                        </tr>
                    </table>
                    
                    <p>A Su√≠√ßa representa o maior custo do roteiro devido aos pre√ßos mais elevados no pa√≠s, mas oferece algumas das experi√™ncias mais memor√°veis da viagem.</p>
                </div>
                
                <div class="cost-charts">
                    <div class="chart-container">
                        <h3>Distribui√ß√£o de Custos por Categoria</h3>
                        <canvas id="categoriesChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Custo por Cidade</h3>
                        <canvas id="citiesChart"></canvas>
                    </div>
                </div>
                
                <div class="city-info">
                    <h3>Resumo de Custos por Categoria (Para o Casal)</h3>
                    <div class="cost-item">
                        <span>Transportes:</span>
                        <span>‚Ç¨${costs.transport.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Hospedagem:</span>
                        <span>‚Ç¨${costs.accommodation.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Alimenta√ß√£o:</span>
                        <span>‚Ç¨${costs.food.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Atra√ß√µes:</span>
                        <span>‚Ç¨${costs.attractions.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Extras:</span>
                        <span>‚Ç¨${costs.extras.toFixed(2)}</span>
                    </div>
                    <div class="total-cost">
                        <span>Total para o Casal:</span>
                        <span>‚Ç¨${costs.totalCost.toFixed(2)}</span>
                    </div>
                    <div class="total-cost">
                        <span>Custo por Pessoa:</span>
                        <span>‚Ç¨${Math.round(costs.totalCost / 2).toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="city-info">
                    <h3>Resumo de Custos por Cidade</h3>
                    ${citySummaryHtml}
                </div>
                
                <div class="city-info">
                    <h3>Dicas para Reduzir Custos</h3>
                    <p>O roteiro atual est√° um pouco acima do or√ßamento de ‚Ç¨4.000 para o casal. Para ajustar:</p>
                    <ul>
                        <li><strong>Transporte:</strong> Considere voos com escala em vez de diretos (economia de ~‚Ç¨100)</li>
                        <li><strong>Hospedagem:</strong> Reserve com maior anteced√™ncia para melhores tarifas</li>
                        <li><strong>Alimenta√ß√£o:</strong> Prepare algumas refei√ß√µes nos hostels com cozinha</li>
                        <li><strong>Su√≠√ßa:</strong> Considere o Swiss Travel Pass para economizar em transportes dentro do pa√≠s</li>
                        <li><strong>Excurs√µes:</strong> Algumas excurs√µes organizadas podem ser feitas por conta pr√≥pria por menor custo</li>
                    </ul>
                    <p>Com essas medidas, √© poss√≠vel reduzir o custo total em 10-15%, adequando-o ao or√ßamento dispon√≠vel.</p>
                </div>
            `;
            
            // Criar gr√°ficos ap√≥s o HTML estar pronto
            setTimeout(() => {
                createCategoryChart(categoryLabels, categoryData, categoryColors);
                createCityChart(cityCosts);
            }, 100);
        }

        function createCategoryChart(labels, data, colors) {
            const ctx = document.getElementById('categoriesChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = Math.round((value / context.dataset.data.reduce((a, b) => a + b, 0)) * 100);
                                    return `${label}: ‚Ç¨${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createCityChart(cityCosts) {
            const ctx = document.getElementById('citiesChart').getContext('2d');
            const cityNames = cityCosts.map(city => city.name.split(' ')[0]); // Primeiro nome apenas para legibilidade
            const cityValues = cityCosts.map(city => city.cost);
            const backgroundColors = cityCosts.map((city, index) => {
                if (city.name.includes('Amsterdam')) {
                    return '#3498db'; // Azul para destacar Amsterdam
                } else if (city.name.includes('Zurich') || city.name.includes('Geneva')) {
                    return '#9b59b6'; // Roxo para destinos su√≠√ßos
                } else if (city.name.includes('Porto') || city.name.includes('Ger√™s')) {
                    return '#e74c3c'; // Vermelho para destinos portugueses
                }
                const hue = (index * 30) % 360;
                return `hsl(${hue}, 70%, 60%)`;
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cityNames,
                    datasets: [{
                        label: 'Custo por Cidade (‚Ç¨)',
                        data: cityValues,
                        backgroundColor: backgroundColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Custo (‚Ç¨)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Inicializar o mapa quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se a biblioteca Leaflet foi carregada
            function initMap() {
                if (typeof L !== 'undefined') {
                    map = L.map('map').setView([45.0, 10.0], 5);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(map);
                    updateMap();
                } else {
                    // Se o Leaflet ainda n√£o estiver carregado, tente novamente em 100ms
                    setTimeout(initMap, 100);
                }
            }
            
            initMap();
        });
    </script>
</body>
</html>
