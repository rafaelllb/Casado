<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
    <title>Roteiro Final: Porto 22/04-24/04 (com pernoite estendida)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .content-wrapper {
            display: flex;
            gap: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background-color: #e9ecef;
        }

        .tab-button.active {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }

        /* Estilos do Container do Mapa */
        .map-container {
            width: 70%;
            position: relative;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f8f9fa;
            aspect-ratio: 4/3;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Estilos dos Marcadores e Popups do Leaflet */
        .leaflet-popup-content {
            font-size: 14px;
            line-height: 1.4;
            padding: 8px;
        }

        .leaflet-popup-content h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 3px;
        }

        .custom-marker {
            background-color: #e74c3c;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
        }

        .custom-marker:hover {
            background-color: #c0392b;
            transform: scale(1.2);
        }

        .custom-marker.active {
            background-color: #2ecc71;
            box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.3);
        }

        /* Painel de Informações */
        .info-panel {
            width: 30%;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 800px;
            overflow-y: auto;
        }

        .city-info {
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .city-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .info-section {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .booking-button {
            display: inline-block;
            padding: 8px 16px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin-top: 10px;
            transition: background-color 0.3s ease;
        }

        .booking-button:hover {
            background-color: #2980b9;
        }

        /* Estilos do Itinerário */
        .itinerary-day {
            background-color: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .itinerary-day h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .full-itinerary {
            display: none;
            padding: 20px;
        }

        /* Estilos do Resumo de Custos */
        .cost-summary {
            background-color: #f1f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .cost-summary h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px dashed #ccc;
        }

        .total-cost {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #3498db;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Estilos para as opções de transporte */
        .transport-options {
            margin-top: 10px;
        }

        .transport-option {
            background-color: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }

        .transport-train {
            border-left-color: #2ecc71;
        }

        .transport-bus {
            border-left-color: #f39c12;
        }

        .transport-flight {
            border-left-color: #9b59b6;
        }

        .transport-car {
            border-left-color: #e74c3c;
        }

        .transport-option h4 {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .transport-option p {
            margin: 5px 0;
            font-size: 14px;
        }

        .economy-badge, .comfort-badge, .time-badge {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .economy-badge {
            background-color: #2ecc71;
            color: white;
        }

        .comfort-badge {
            background-color: #9b59b6;
            color: white;
        }

        .time-badge {
            background-color: #f39c12;
            color: white;
        }

        /* Resumo visual dos custos */
        .cost-charts {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        .chart-container {
            width: 45%;
            min-width: 300px;
            border-radius: 8px;
            background-color: white;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Responsividade */
        @media (max-width: 1200px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .map-container, .info-panel {
                width: 100%;
            }
            
            .map-container {
                height: 400px;
            }

            .chart-container {
                width: 100%;
            }
        }

        /* Estilos adicionados para transporte */
        .transport-recommended {
            font-weight: bold;
            color: #27ae60;
        }

        .budget-overview {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .budget-overview.over-budget {
            background-color: #e74c3c;
        }

        .budget-overview h3 {
            color: white;
            margin-bottom: 10px;
        }

        .budget-meter {
            height: 24px;
            background-color: #eee;
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
        }

        .budget-fill {
            height: 100%;
            background-color: #3498db;
            width: 0%; /* Será ajustado com JavaScript */
            transition: width 1s ease-in-out;
        }

        .budget-over {
            background-color: #e74c3c;
        }

        .budget-within {
            background-color: #2ecc71;
        }

        /* Destaque para Tobogã */
        .highlight-attraction {
            background-color: #fef9e7;
            border-left: 4px solid #f1c40f;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .highlight-attraction h4 {
            color: #d35400;
            margin-bottom: 8px;
        }

        .highlight-attraction img {
            max-width: 100%;
            border-radius: 4px;
            margin: 10px 0;
        }

        /* Novo estilo para destacar os dias extras */
        .extra-day {
            background-color: #e8f8f5;
            border-left: 4px solid #1abc9c;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .extra-day h4 {
            color: #16a085;
            margin-bottom: 8px;
        }

        /* Estilo para comparação antes/depois */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .comparison-table th, 
        .comparison-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .comparison-table th {
            background-color: #f2f2f2;
        }

        .comparison-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .highlight-row {
            background-color: #e8f8f5 !important;
        }
        
        /* Estilo para destaque da Holanda */
        .holland-highlight {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .holland-highlight h4 {
            color: #2980b9;
            margin-bottom: 8px;
        }
        
        /* Estilo para Portugal */
        .portugal-highlight {
            background-color: #f2d7d5;
            border-left: 4px solid #c0392b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .portugal-highlight h4 {
            color: #922b21;
            margin-bottom: 8px;
        }
        
        /* Estilo para economias */
        .savings-highlight {
            background-color: #ebf5e8;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .savings-highlight h4 {
            color: #27ae60;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Roteiro Final Lua de Mel 2025</h1>
        
        <div class="tab-buttons">
            <button class="tab-button active" data-tab="map" onclick="showTab('map')">Mapa</button>
            <button class="tab-button" data-tab="full-itinerary" onclick="showTab('full-itinerary')">Roteiro Completo</button>
            <button class="tab-button" data-tab="summary" onclick="showTab('summary')">Resumo Financeiro</button>
        </div>
        
        <div class="content-wrapper" id="mapView">
            <div class="map-container">
                <div id="map"></div>
            </div>
            <div class="info-panel" id="infoPanel">
                <div id="cityInfo">
                    Selecione uma cidade no mapa para ver detalhes
                </div>
            </div>
        </div>

        <div class="full-itinerary" id="fullItinerary"></div>
    </div>

    <script>
        const itineraryData = {
            cities: {
                albufeira: {
                    name: "Albufeira (Casamento)",
                    coordinates: { lat: 37.0891, lng: -8.2401 },
                    dates: "12/04 - 14/04",
                    activities: [
                        "Chegada a Albufeira (12/04)",
                        "Casamento (13/04)",
                        "Preparação para próximo destino (14/04)"
                    ],
                    accommodation: {
                        name: "Hospedagem já confirmada",
                        cost: 0, // Já pago/reservado
                        notes: "Hospedagem já confirmada para estas datas"
                    }
                },
                madrid: {
                    name: "Madrid (Passagem)",
                    coordinates: { lat: 40.4168, lng: -3.7038 },
                    dates: "14/04 (visita de dia)",
                    transport: {
                        from: "Albufeira",
                        options: [
                            {
                                type: "onibus",
                                company: "FlixBus (noturno)",
                                duration: "10-12h",
                                cost: 35,
                                bookingUrl: "https://www.flixbus.pt",
                                notes: "Opção econômica e ecológica",
                                recommended: true,
                                badge: "economia"
                            },
                            {
                                type: "voo",
                                company: "Ryanair (Faro)",
                                duration: "1h45",
                                cost: 90,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Opção mais rápida, mas mais cara",
                                recommended: false,
                                badge: "tempo"
                            }
                        ]
                    },
                    activities: [
                        "Plaza de Cibeles (gratuito)",
                        "Exterior do Estádio Santiago Bernabéu (gratuito)",
                        "Puerta del Sol (gratuito)",
                        "Tempo para almoço típico espanhol"
                    ]
                },
                valencia: {
                    name: "Valencia",
                    coordinates: { lat: 39.4699, lng: -0.3763 },
                    dates: "14/04 - 16/04",
                    transport: {
                        from: "Madrid",
                        options: [
                            {
                                type: "onibus",
                                company: "ALSA",
                                duration: "4h-4h30",
                                cost: 30,
                                bookingUrl: "https://www.alsa.es",
                                notes: "Opção mais econômica, recomendada",
                                recommended: true,
                                badge: "economia"
                            },
                            {
                                type: "trem",
                                company: "Renfe (AVE)",
                                duration: "1h40",
                                cost: 45,
                                bookingUrl: "https://www.renfe.com",
                                notes: "Trem de alta velocidade, muito confortável",
                                recommended: false,
                                badge: "conforto"
                            }
                        ]
                    },
                    activities: [
                        "L'Oceanogràfic (ingresso com desconto online: 35€ em vez de 40€)",
                        "Centro histórico de Valência (passeio gratuito)",
                        "Mercado Central (gratuito)",
                        "Praia de Malvarrosa (gratuita)",
                        "Jardins do Túria (antigo leito do rio, convertido em parque)"
                    ],
                    accommodation: {
                        name: "Red Nest Hostel (dormitório compartilhado)",
                        cost: 60,
                        bookingUrl: "https://www.hostelworld.com",
                        notes: "Localização central, cozinha para preparar refeições (2 noites)"
                    }
                },
                geneva: {
                    name: "Geneva",
                    coordinates: { lat: 46.2044, lng: 6.1432 },
                    dates: "16/04 - 18/04",
                    transport: {
                        from: "Valencia",
                        options: [
                            {
                                type: "voo",
                                company: "Conexão via Madrid/Barcelona",
                                duration: "4h-5h (incluindo conexão)",
                                cost: 80,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Reservando com antecedência para obter tarifas mais baixas",
                                recommended: true,
                                badge: "economia"
                            },
                            {
                                type: "voo",
                                company: "EasyJet (direto, se disponível)",
                                duration: "2h",
                                cost: 130,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Voo direto, opção mais rápida",
                                recommended: false,
                                badge: "tempo"
                            }
                        ]
                    },
                    activities: [
                        "Jet d'Eau (gratuito)",
                        "CERN (visita gratuita com reserva antecipada)",
                        "Passeio pelo lago Leman (gratuito)",
                        "Excursão de um dia a Les Diablerets (veja abaixo)",
                        "Catedral de São Pedro (entrada gratuita)"
                    ],
                    accommodation: {
                        name: "Couchsurfing",
                        cost: 30,
                        bookingUrl: "https://www.couchsurfing.com",
                        notes: "Taxa de agradecimento ao anfitrião (2 noites)"
                    },
                    special: {
                        title: "Tobogã Alpino em Les Diablerets (Glacier 3000)",
                        description: "Uma das melhores experiências da Suíça! O Alpine Coaster é um dos maiores tobogãs em trilhos da Europa, com 1000 metros de descida emocionante a velocidades de até 40 km/h. A pista serpenteante oferece vistas deslumbrantes das montanhas.",
                        details: [
                            "Localização: Glacier 3000, próximo a Les Diablerets (2h de Geneva)",
                            "Preço: 70€/pessoa (pacote básico com desconto online)",
                            "Duração: Excursão de dia inteiro (8h)",
                            "Melhor época: Funciona de maio a outubro (verificar disponibilidade para abril)",
                            "Alternativa em caso de fechamento: Tobogã no Monte Pilatus (perto de Lucerna)"
                        ],
                        image: "https://sample-image-url.com/toboga-suica.jpg",
                        bookingUrl: "https://www.glacier3000.ch"
                    }
                },
                pilatus: {
                    name: "Monte Pilatus (Tobogã)",
                    coordinates: { lat: 46.9794, lng: 8.2544 },
                    dates: "18/04",
                    transport: {
                        from: "Geneva",
                        options: [
                            {
                                type: "trem",
                                company: "SBB (via Lucerna)",
                                duration: "3h30",
                                cost: 55,
                                bookingUrl: "https://www.sbb.ch",
                                notes: "Trem regional com conexões",
                                recommended: true,
                                badge: "economia"
                            }
                        ]
                    },
                    activities: [
                        "Rodelbahn - Maior tobogã de trenó da Suíça (10€/descida com desconto online)",
                        "Teleférico panorâmico para o topo (40€ ida e volta, procurar promoções)",
                        "Vistas deslumbrantes dos Alpes Suíços (gratuito)",
                        "Caminhadas em trilhas panorâmicas (gratuito)"
                    ],
                    special: {
                        title: "Rodelbahn - O Maior Tobogã em Trilhos da Suíça",
                        description: "O tobogã alpino do Monte Pilatus é uma experiência única e emocionante, onde você controla sua própria velocidade descendo 1350 metros através de curvas, túneis e giros a velocidades de até 40km/h. É considerado um dos mais longos e espetaculares da Suíça.",
                        details: [
                            "Comprimento: 1350 metros de pura adrenalina",
                            "Localização: Monte Pilatus, próximo a Lucerna",
                            "Preço: 10€ por descida (com desconto online)",
                            "Altitude: Localizado a 1350m acima do nível do mar",
                            "Funcionamento: Disponível de abril a novembro (clima permitindo)"
                        ],
                        image: "https://sample-image-url.com/toboga-pilatus.jpg",
                        bookingUrl: "https://www.pilatus.ch"
                    }
                },
                zurich: {
                    name: "Zurich",
                    coordinates: { lat: 47.3769, lng: 8.5417 },
                    dates: "18/04 - 20/04", // ATUALIZADO
                    transport: {
                        from: "Pilatus",
                        options: [
                            {
                                type: "trem",
                                company: "SBB (via Lucerna)",
                                duration: "1h30",
                                cost: 40,
                                bookingUrl: "https://www.sbb.ch",
                                notes: "Conexão confortável via Lucerna",
                                recommended: true,
                                badge: "tempo"
                            }
                        ]
                    },
                    activities: [
                        "Lago Zurich (passeio gratuito)",
                        "Bahnhofstrasse (vitrine-shopping gratuito)",
                        "Lindenhof (mirante gratuito)",
                        "Passeio pelo centro histórico (gratuito)",
                        "Excursão a Lucerna (cidade próxima: trem 25€ ida e volta)",
                        "Uetliberg - Montanha de Zurich (transporte + trilha: 15€)"
                    ],
                    accommodation: {
                        name: "Airbnb compartilhado",
                        cost: 150,
                        bookingUrl: "https://www.airbnb.com",
                        notes: "Apartamento compartilhado com cozinha para economia em refeições (2 noites)"
                    }
                },
                amsterdam: {
                    name: "Amsterdam",
                    coordinates: { lat: 52.3676, lng: 4.9041 },
                    dates: "20/04 - 22/04", // ATUALIZADO
                    transport: {
                        from: "Zurich",
                        options: [
                            {
                                type: "onibus",
                                company: "FlixBus (noturno)",
                                duration: "11-13h",
                                cost: 50,
                                bookingUrl: "https://www.flixbus.com",
                                notes: "Opção econômica, viagem noturna poupa uma diária de hotel",
                                recommended: true,
                                badge: "economia"
                            },
                            {
                                type: "voo",
                                company: "Swiss/KLM (direto)",
                                duration: "1h40",
                                cost: 110,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Várias opções de voos diretos por dia",
                                recommended: false,
                                badge: "tempo"
                            },
                            {
                                type: "trem",
                                company: "Conexões via Alemanha",
                                duration: "8h-9h",
                                cost: 150,
                                bookingUrl: "https://www.raileurope.com",
                                notes: "Longo mas com paisagens bonitas",
                                recommended: false
                            }
                        ]
                    },
                    activities: [
                        "Keukenhof (Parque de Tulipas: 16€ por pessoa com desconto online)",
                        "Transporte público + barco para Giethoorn (40€ ida e volta)",
                        "Passeio de barco pelos canais (15€)",
                        "Free Walking Tour pelo centro (gorjeta de 5-10€)",
                        "Vondelpark (gratuito)",
                        "Mercado de flores flutuante (gratuito para visitar)"
                    ],
                    accommodation: {
                        name: "MEININGER Hostel",
                        cost: 80,
                        bookingUrl: "https://www.meininger-hotels.com",
                        notes: "Dormitório compartilhado, cozinha disponível (2 noites)"
                    },
                    special: {
                        title: "Giethoorn - A Veneza do Norte",
                        description: "Uma vila encantadora nos Países Baixos conhecida por seus canais, pontes e ausência quase total de ruas. Quase todos os deslocamentos são feitos de barco ou a pé através de pequenas pontes que cruzam os canais.",
                        details: [
                            "Visite por conta própria usando transporte público",
                            "Trem + ônibus de Amsterdam para Giethoorn (2 horas)",
                            "Aluguel de barco local para explorar canais (15€/hora)",
                            "Uma das vilas mais fotogênicas da Europa",
                            "Preço total: 40€ por pessoa (muito mais econômico que excursões organizadas)"
                        ],
                        image: "https://sample-image-url.com/giethoorn.jpg",
                        bookingUrl: "https://9292.nl/en"
                    }
                },
                porto: {
                    name: "Porto",
                    coordinates: { lat: 41.1579, lng: -8.6291 },
                    dates: "22/04 - 24/04", // ATUALIZADO: estadia mais longa
                    transport: {
                        from: "Amsterdam",
                        options: [
                            {
                                type: "voo",
                                company: "Múltiplas companhias (com escala)",
                                duration: "5-6h",
                                cost: 70,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Opções econômicas com antecedência, geralmente têm escala",
                                recommended: true,
                                badge: "economia"
                            },
                            {
                                type: "voo",
                                company: "Transavia/TAP (direto)",
                                duration: "3h",
                                cost: 95,
                                bookingUrl: "https://www.skyscanner.pt",
                                notes: "Voo direto, porém mais caro",
                                recommended: false,
                                badge: "tempo"
                            }
                        ]
                    },
                    activities: [
                        "Aluguel de carro econômico (95€/3 dias através de agregadores como AutoEurope)",
                        "Caves do Vinho do Porto (algumas têm degustação gratuita/econômica)",
                        "Ribeira (passeio clássico)",
                        "Ponte Dom Luís I (gratuito)",
                        "Livraria Lello (entrada: 5€, dedutível na compra de livros)",
                        "Torre dos Clérigos (subida: 6€)",
                        "Jantar na Ribeira com vista para o rio"
                    ],
                    accommodation: {
                        name: "Hostel Yes! Porto (dormitório)",
                        cost: 40,
                        bookingUrl: "https://www.yesporto.com",
                        notes: "Localização central, cozinha compartilhada (2 noites)"
                    },
                    extraDay: {
                        title: "Dia Extra em Porto (22/04-24/04)",
                        description: "Aproveitando o tempo adicional em Porto para explorar melhor a cidade e se preparar para as excursões a Foz Tua e Gerês.",
                        activities: [
                            "Mais tempo para relaxar e explorar a cidade",
                            "Possibilidade de visitar Matosinhos para experimentar os melhores peixes e mariscos",
                            "Preparação para o roteiro em Portugal"
                        ]
                    }
                },
                foztua: {
                    name: "Foz Tua (a partir do Porto)",
                    coordinates: { lat: 41.2193, lng: -7.4265 },
                    dates: "24/04 (dia)",
                    activities: [
                        "Visita à Barragem de Foz Tua",
                        "Região vinícola do Douro",
                        "Paisagens classificadas UNESCO",
                        "Passeio de barco no rio Douro (opcional: 25€)"
                    ],
                    transport: {
                        special: "Parte do percurso com carro alugado (2h de carro do Porto)"
                    }
                },
                geres: {
                    name: "Gerês",
                    coordinates: { lat: 41.7186, lng: -8.1668 },
                    dates: "24/04 (noite) - 25/04",
                    activities: [
                        "Trilha Cascata do Arado (gratuita)",
                        "Ponte da Misarela (gratuita)",
                        "Miradouro da Pedra Bela (gratuito)",
                        "Lagoas naturais (gratuitas)",
                        "Piquenique na natureza (economia em refeições)"
                    ],
                    accommodation: {
                        name: "Albergue de Campo (tipo rural)",
                        cost: 50,
                        bookingUrl: "https://www.booking.com",
                        notes: "Opção com cozinha para preparar refeições"
                    },
                    transport: {
                        special: "Continuação com carro alugado (2h a partir de Foz Tua)"
                    }
                },
                lisboa_final: {
                    name: "Lisboa (Partida)",
                    coordinates: { lat: 38.7223, lng: -9.1393 },
                    dates: "26/04",
                    transport: {
                        from: "Gerês",
                        options: [
                            {
                                type: "carro",
                                company: "Carro alugado (continuação)",
                                duration: "4h30",
                                cost: 0, // Já contabilizado no aluguel
                                bookingUrl: "",
                                notes: "Saída cedo para chegar a Lisboa com tempo suficiente",
                                recommended: true,
                                badge: "tempo"
                            }
                        ]
                    },
                    activities: [
                        "Aeroporto de Lisboa para devolução do carro alugado",
                        "Tempo livre dependendo do horário do voo",
                        "Retorno ao Brasil (26/04)"
                    ]
                }
            },
            order: ['albufeira', 'madrid', 'valencia', 'geneva', 'pilatus', 'zurich', 'amsterdam', 'porto', 'foztua', 'geres', 'lisboa_final']
        };

        let map;
        let activeMarker;
        let markers = {};
        let polylines = [];

        function updateMap() {
            // Limpar marcadores e linhas existentes
            clearMapElements();

            const routeCoordinates = [];

            itineraryData.order.forEach((cityId, index) => {
                const city = itineraryData.cities[cityId];
                const coords = city.coordinates;

                // Criar marcador
                const marker = L.marker([coords.lat, coords.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        iconSize: [12, 12]
                    })
                }).addTo(map);

                marker.bindPopup(`
                    <h3>${city.name}</h3>
                    <p>Data: ${city.dates}</p>
                `);

                marker.on('click', () => {
                    if (activeMarker) {
                        activeMarker.getElement().classList.remove('active');
                    }
                    marker.getElement().classList.add('active');
                    activeMarker = marker;
                    showCityInfo(cityId);
                });

                markers[cityId] = marker;
                routeCoordinates.push([coords.lat, coords.lng]);

                // Conectar com a próxima cidade
                if (index < itineraryData.order.length - 1) {
                    const nextCity = itineraryData.cities[itineraryData.order[index + 1]].coordinates;
                    const polyline = L.polyline([
                        [coords.lat, coords.lng],
                        [nextCity.lat, nextCity.lng]
                    ], {
                        color: '#3498db',
                        weight: 2,
                        opacity: 0.7,
                        dashArray: '5, 10'
                    }).addTo(map);
                    polylines.push(polyline);
                }
            });

            // Ajustar visualização
            map.fitBounds(L.latLngBounds(routeCoordinates));
        }

        function clearMapElements() {
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            markers = {};
            polylines.forEach(polyline => map.removeLayer(polyline));
            polylines = [];
        }

        function showCityInfo(cityId) {
            const city = itineraryData.cities[cityId];
            if (!city) return;

            // Preparar HTML para as opções de transporte
            let transportHtml = '';
            
            if (city.transport && city.transport.options) {
                transportHtml = `
                    <div class="info-section">
                        <h4>Transporte de ${city.transport.from} para ${city.name}:</h4>
                        <div class="transport-options">
                `;
                
                city.transport.options.forEach(option => {
                    const typeClass = `transport-${option.type.toLowerCase()}`;
                    const recommendedClass = option.recommended ? 'transport-recommended' : '';
                    const badgeHtml = option.badge ? `<span class="${option.badge}-badge">${option.badge === 'economia' ? 'Mais econômico' : (option.badge === 'conforto' ? 'Mais confortável' : 'Mais rápido')}</span>` : '';
                    
                    transportHtml += `
                        <div class="transport-option ${typeClass}">
                            <h4>${getTransportTypeIcon(option.type)} ${option.type.toUpperCase()} ${badgeHtml}</h4>
                            <p><strong>Empresa:</strong> ${option.company}</p>
                            <p><strong>Duração:</strong> ${option.duration}</p>
                            <p><strong>Custo:</strong> €${option.cost}</p>
                            ${option.notes ? `<p><strong>Notas:</strong> <span class="${recommendedClass}">${option.notes}</span></p>` : ''}
                            ${option.bookingUrl ? `<a href="${option.bookingUrl}" target="_blank" class="booking-button">Reservar</a>` : ''}
                        </div>
                    `;
                });
                
                transportHtml += `
                        </div>
                    </div>
                `;
            } else if (city.transport && city.transport.special) {
                transportHtml = `
                    <div class="info-section">
                        <h4>Transporte:</h4>
                        <p>${city.transport.special}</p>
                    </div>
                `;
            }

            // Adicionar informações especiais (como tobogã ou Giethoorn)
            let specialHtml = '';
            if (city.special) {
                let specialClass = 'highlight-attraction';
                if (city.name.includes('Amsterdam')) {
                    specialClass = 'holland-highlight';
                }
                
                specialHtml = `
                    <div class="${specialClass}">
                        <h4>${city.special.title}</h4>
                        <p>${city.special.description}</p>
                        <ul>
                            ${city.special.details.map(detail => `<li>${detail}</li>`).join('')}
                        </ul>
                        <a href="${city.special.bookingUrl}" target="_blank" class="booking-button">Verificar Disponibilidade</a>
                    </div>
                `;
            }
            
            // Adicionar informações sobre o dia extra
            let extraDayHtml = '';
            if (city.extraDay) {
                extraDayHtml = `
                    <div class="extra-day">
                        <h4>${city.extraDay.title}</h4>
                        <p>${city.extraDay.description}</p>
                        <ul>
                            ${city.extraDay.activities.map(activity => `<li>${activity}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Adicionar destaque para Portugal
            let portugalHtml = '';
            if (city.name.includes('Porto') || city.name.includes('Gerês') || city.name.includes('Foz Tua')) {
                portugalHtml = `
                    <div class="portugal-highlight">
                        <h4>Roteiro em Portugal</h4>
                        <p>Conforme solicitado, o roteiro em Portugal foi ampliado:</p>
                        <ul>
                            <li><strong>22/04-24/04:</strong> Dois dias completos em Porto - tempo para explorar a cidade</li>
                            <li><strong>24/04:</strong> Visita a Foz Tua durante o dia → Viagem para Gerês</li>
                            <li><strong>25/04:</strong> Dia completo em Gerês</li>
                            <li><strong>26/04:</strong> Viagem para Lisboa apenas para pegar o voo de retorno</li>
                        </ul>
                        <p>Este formato otimizado permite aproveitar melhor Portugal como solicitado.</p>
                    </div>
                `;
            }
            
            // Adicionar dicas de economia
            let savingsHtml = '';
            if (city.name.includes('Porto')) {
                savingsHtml = `
                    <div class="savings-highlight">
                        <h4>Dicas de Economia</h4>
                        <p>Para manter o orçamento dentro de €2000 por pessoa:</p>
                        <ul>
                            <li>Use o cartão <strong>Andante Tour</strong> para o transporte em Porto (€7/dia para viagens ilimitadas)</li>
                            <li>Experimente os restaurantes populares com "menu do dia" (€8-12 por refeição completa)</li>
                            <li>Para o carro alugado, opte pela devolução em Porto mesmo (economiza taxa de devolução em outro local)</li>
                            <li>Leve lanches nas excursões e compre água em supermercados</li>
                        </ul>
                    </div>
                `;
            } else if (city.name.includes('Zurich') || city.name.includes('Geneva')) {
                savingsHtml = `
                    <div class="savings-highlight">
                        <h4>Dicas de Economia na Suíça</h4>
                        <p>A Suíça é cara, mas é possível economizar:</p>
                        <ul>
                            <li>Compre alimentos nos supermercados Migros ou Coop (mais baratos)</li>
                            <li>Use a água das fontes públicas (potável e gratuita)</li>
                            <li>Aproveite os passeios e atrações gratuitas (muitos mirantes e trilhas)</li>
                            <li>Passe pelo posto de turismo para pegar mapas e dicas locais gratuitas</li>
                        </ul>
                    </div>
                `;
            } else if (city.name.includes('Amsterdam')) {
                savingsHtml = `
                    <div class="savings-highlight">
                        <h4>Dicas de Economia em Amsterdam</h4>
                        <p>Para aproveitar Amsterdam sem gastar muito:</p>
                        <ul>
                            <li>Alugue bicicleta por dia inteiro em vez de transporte público (€10/dia)</li>
                            <li>Visite o Museu Van Gogh à noite de sexta-feira (horário mais barato)</li>
                            <li>Procure os restaurantes FEBO para refeições rápidas e econômicas</li>
                            <li>Prefira os albergues da zona norte (mais baratos e conectados por ferry gratuito)</li>
                        </ul>
                    </div>
                `;
            }

            const infoHtml = `
                <div class="city-info">
                    <h3>${city.name}</h3>
                    <div class="info-section">
                        <p><strong>Datas:</strong> ${city.dates}</p>
                    </div>
                    
                    ${transportHtml}
                    
                    <div class="info-section">
                        <h4>Atividades:</h4>
                        <ul>
                            ${city.activities.map(activity => `<li>${activity}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${extraDayHtml}
                    
                    ${specialHtml}
                    
                    ${portugalHtml}
                    
                    ${savingsHtml}
                    
                    ${city.accommodation ? `
                        <div class="info-section">
                            <h4>Hospedagem:</h4>
                            <p>${city.accommodation.name}</p>
                            <p><strong>Custo:</strong> €${city.accommodation.cost}</p>
                            ${city.accommodation.notes ? `<p><small>${city.accommodation.notes}</small></p>` : ''}
                            <a href="${city.accommodation.bookingUrl}" target="_blank" class="booking-button">Reservar Hospedagem</a>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('cityInfo').innerHTML = infoHtml;
        }

        function getTransportTypeIcon(type) {
            switch(type.toLowerCase()) {
                case 'trem':
                    return '🚆';
                case 'onibus':
                    return '🚌';
                case 'voo':
                    return '✈️';
                case 'carro':
                    return '🚗';
                case 'trem-onibus':
                    return '🚆/🚌';
                default:
                    return '🚢';
            }
        }

        function showTab(tabName) {
            // Atualizar estado das abas
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });

            const mapView = document.getElementById('mapView');
            const fullItinerary = document.getElementById('fullItinerary');

            // Atualizar visibilidade das seções
            switch(tabName) {
                case 'map':
                    mapView.style.display = 'flex';
                    fullItinerary.style.display = 'none';
                    break;
                    
                case 'full-itinerary':
                    mapView.style.display = 'none';
                    fullItinerary.style.display = 'block';
                    showFullItinerary(); // Mostrar roteiro completo
                    break;
                    
                case 'summary':
                    mapView.style.display = 'none';
                    fullItinerary.style.display = 'block';
                    showFinancialSummary(); // Mostrar resumo financeiro
                    break;
            }
        }

        function showFullItinerary() {
            let itineraryHtml = '';
            
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                
                // Preparar HTML para as opções de transporte
                let transportHtml = '';
                
                if (city.transport && city.transport.options) {
                    transportHtml = `
                        <div class="info-section">
                            <h4>Transporte de ${city.transport.from} para ${city.name}:</h4>
                            <div class="transport-options">
                    `;
                    
                    // Encontrar a opção recomendada
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    
                    if (recommendedOption) {
                        const typeClass = `transport-${recommendedOption.type.toLowerCase()}`;
                        const badgeHtml = recommendedOption.badge ? `<span class="${recommendedOption.badge}-badge">${recommendedOption.badge === 'economia' ? 'Mais econômico' : (recommendedOption.badge === 'conforto' ? 'Mais confortável' : 'Mais rápido')}</span>` : '';
                        
                        transportHtml += `
                            <div class="transport-option ${typeClass}">
                                <h4>${getTransportTypeIcon(recommendedOption.type)} ${recommendedOption.type.toUpperCase()} ${badgeHtml}</h4>
                                <p><strong>Empresa:</strong> ${recommendedOption.company}</p>
                                <p><strong>Duração:</strong> ${recommendedOption.duration}</p>
                                <p><strong>Custo:</strong> €${recommendedOption.cost}</p>
                                ${recommendedOption.notes ? `<p><strong>Notas:</strong> <span class="transport-recommended">${recommendedOption.notes}</span></p>` : ''}
                                ${recommendedOption.bookingUrl ? `<a href="${recommendedOption.bookingUrl}" target="_blank" class="booking-button">Reservar</a>` : ''}
                            </div>
                        `;
                    }
                    
                    transportHtml += `
                            </div>
                            <p><small>Para ver todas as opções de transporte, clique na cidade no mapa.</small></p>
                        </div>
                    `;
                } else if (city.transport && city.transport.special) {
                    transportHtml = `
                        <div class="info-section">
                            <h4>Transporte:</h4>
                            <p>${city.transport.special}</p>
                        </div>
                    `;
                }

                // Adicionar informações especiais (como tobogã ou Giethoorn)
                let specialHtml = '';
                if (city.special) {
                    let specialClass = 'highlight-attraction';
                    if (city.name.includes('Amsterdam')) {
                        specialClass = 'holland-highlight';
                    }
                    
                    specialHtml = `
                        <div class="${specialClass}">
                            <h4>${city.special.title}</h4>
                            <p>${city.special.description}</p>
                            <ul>
                                ${city.special.details.map(detail => `<li>${detail}</li>`).join('')}
                            </ul>
                            <a href="${city.special.bookingUrl}" target="_blank" class="booking-button">Verificar Disponibilidade</a>
                        </div>
                    `;
                }
                
                // Adicionar informações sobre o dia extra
                let extraDayHtml = '';
                if (city.extraDay) {
                    extraDayHtml = `
                        <div class="extra-day">
                            <h4>${city.extraDay.title}</h4>
                            <p>${city.extraDay.description}</p>
                            <ul>
                                ${city.extraDay.activities.map(activity => `<li>${activity}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                // Adicionar destaque para Portugal
                let portugalHtml = '';
                if (city.name.includes('Porto') || city.name.includes('Gerês') || city.name.includes('Foz Tua')) {
                    portugalHtml = `
                        <div class="portugal-highlight">
                            <h4>Roteiro em Portugal</h4>
                            <p>Conforme solicitado, o roteiro em Portugal foi ampliado:</p>
                            <ul>
                                <li><strong>22/04-24/04:</strong> Dois dias completos em Porto - tempo para explorar a cidade</li>
                                <li><strong>24/04:</strong> Visita a Foz Tua durante o dia → Viagem para Gerês</li>
                                <li><strong>25/04:</strong> Dia completo em Gerês</li>
                                <li><strong>26/04:</strong> Viagem para Lisboa apenas para pegar o voo de retorno</li>
                            </ul>
                            <p>Este formato otimizado permite aproveitar melhor Portugal como solicitado.</p>
                        </div>
                    `;
                }

                // Adicionar dicas de economia
                let savingsHtml = '';
                if (city.name.includes('Porto')) {
                    savingsHtml = `
                        <div class="savings-highlight">
                            <h4>Dicas de Economia</h4>
                            <p>Para manter o orçamento dentro de €2000 por pessoa:</p>
                            <ul>
                                <li>Use o cartão <strong>Andante Tour</strong> para o transporte em Porto (€7/dia para viagens ilimitadas)</li>
                                <li>Experimente os restaurantes populares com "menu do dia" (€8-12 por refeição completa)</li>
                                <li>Para o carro alugado, opte pela devolução em Porto mesmo (economiza taxa de devolução em outro local)</li>
                                <li>Leve lanches nas excursões e compre água em supermercados</li>
                            </ul>
                        </div>
                    `;
                }
                
                itineraryHtml += `
                    <div class="itinerary-day">
                        <h3>${city.name} - ${city.dates}</h3>
                        
                        ${transportHtml}
                        
                        <div class="info-section">
                            <h4>Atividades:</h4>
                            <ul>
                                ${city.activities.map(activity => `<li>${activity}</li>`).join('')}
                            </ul>
                        </div>
                        
                        ${extraDayHtml}
                        
                        ${specialHtml}
                        
                        ${portugalHtml}
                        
                        ${savingsHtml}
                        
                        ${city.accommodation ? `
                            <div class="info-section">
                                <h4>Hospedagem:</h4>
                                <p>${city.accommodation.name} - €${city.accommodation.cost}</p>
                                ${city.accommodation.notes ? `<p><small>${city.accommodation.notes}</small></p>` : ''}
                                <a href="${city.accommodation.bookingUrl}" target="_blank" class="booking-button">Reservar</a>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            // Resumo das mudanças do roteiro
            const roteiroDiff = `
                <div class="portugal-highlight">
                    <h4>Roteiro Final: Estadia Estendida em Porto</h4>
                    <p>O roteiro foi ajustado para incluir duas noites em Porto (22/04 para 24/04) conforme solicitado, com a realocação de noites de outras cidades.</p>
                    
                    <h5 style="margin-top: 15px; margin-bottom: 8px;">Cronograma Final Atualizado:</h5>
                    <ul>
                        <li><strong>12-14/04:</strong> Albufeira (Casamento)</li>
                        <li><strong>14/04:</strong> Madrid (apenas visita)</li>
                        <li><strong>14-16/04:</strong> Valencia (2 noites)</li>
                        <li><strong>16-18/04:</strong> Geneva (2 noites, incluindo tobogã)</li>
                        <li><strong>18-20/04:</strong> Zurich (2 noites)</li>
                        <li><strong>20-22/04:</strong> Amsterdam (2 noites, incluindo Keukenhof e Giethoorn)</li>
                        <li><strong>22-24/04:</strong> Porto (2 noites)</li>
                        <li><strong>24-25/04:</strong> Gerês (1 noite, com passagem por Foz Tua)</li>
                        <li><strong>26/04:</strong> Lisboa (apenas para pegar o voo)</li>
                    </ul>
                    
                    <p style="margin-top: 15px;"><strong>Novas datas:</strong> Reduziu-se 1 dia em Zurich (até 20/04 em vez de 21/04) e adiantou-se a estadia em Amsterdam (20/04-22/04) para aumentar o tempo em Porto (22/04-24/04).</p>
                </div>
            `;
            
            // Calcular custos para o roteiro atual
            const costs = calculateTotalCosts();
            const totalBudget = 2000; // Orçamento definido por pessoa
            // Como é um casal, multiplicamos o orçamento por 2
            const totalCouplesBudget = totalBudget * 2;
            const budgetRemaining = totalCouplesBudget - costs.totalCost;
            const budgetPercentage = (costs.totalCost / totalCouplesBudget) * 100;
            
            const budgetClass = budgetRemaining >= 0 ? 'budget-within' : 'budget-over';
            const budgetOverviewClass = budgetRemaining >= 0 ? '' : 'over-budget';
            
            document.getElementById('fullItinerary').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">Roteiro Final Lua de Mel 2025</h2>
                
                <div class="budget-overview ${budgetOverviewClass}">
                    <h3>Orçamento Total (Casal): €${totalCouplesBudget}</h3>
                    <div class="budget-meter">
                        <div class="budget-fill ${budgetClass}" style="width: ${Math.min(budgetPercentage, 100)}%;"></div>
                    </div>
                    <p><strong>Custo Estimado:</strong> €${costs.totalCost}</p>
                    <p><strong>${budgetRemaining >= 0 ? 'Saldo Restante' : 'Excedente'}: </strong> 
                       €${Math.abs(budgetRemaining).toFixed(2)} ${budgetRemaining >= 0 ? '✅' : '❌'}</p>
                </div>
                
                ${roteiroDiff}
                
                <div class="savings-highlight">
                    <h4>Principais Economias no Roteiro Atualizado</h4>
                    <p>Para adequar o orçamento ao valor de €2.000 por pessoa, foram feitas as seguintes modificações:</p>
                    <ul>
                        <li><strong>Transporte:</strong> Opção por ônibus e voos com conexão quando possível (€310 de economia)</li>
                        <li><strong>Hospedagem:</strong> Dormitórios maiores, Couchsurfing e Airbnb compartilhado (€265 de economia)</li>
                        <li><strong>Alimentação:</strong> Preparo de refeições nos alojamentos e compras em supermercados (€210 de economia)</li>
                        <li><strong>Atrações:</strong> Ingressos com desconto online e alternativas gratuitas (€150 de economia)</li>
                        <li><strong>Extras:</strong> Foco nas experiências essenciais (€150 de economia)</li>
                    </ul>
                    <p>Total de economia: €1.085 para o casal, permitindo manter todos os destinos dentro do orçamento.</p>
                </div>
                
                ${itineraryHtml}
                
                <div class="cost-summary">
                    <h3>Resumo Financeiro (Para o Casal)</h3>
                    <div class="cost-item">
                        <span>Transportes:</span>
                        <span>€${costs.transport}</span>
                    </div>
                    <div class="cost-item">
                        <span>Hospedagem:</span>
                        <span>€${costs.accommodation}</span>
                    </div>
                    <div class="cost-item">
                        <span>Alimentação:</span>
                        <span>€${costs.food}</span>
                    </div>
                    <div class="cost-item">
                        <span>Atrações (incluindo Tobogã e Giethoorn):</span>
                        <span>€${costs.attractions}</span>
                    </div>
                    <div class="cost-item">
                        <span>Extras:</span>
                        <span>€${costs.extras}</span>
                    </div>
                    <div class="total-cost">
                        <span>Total para o Casal:</span>
                        <span>€${costs.totalCost}</span>
                    </div>
                    <div class="total-cost">
                        <span>Custo por Pessoa:</span>
                        <span>€${Math.round(costs.totalCost / 2)}</span>
                    </div>
                </div>
            `;
        }

        function calculateTotalCosts() {
            let transportCost = 0;
            let accommodationCost = 0;
            const totalDays = 15; // Número de dias da viagem
            
            // Calcular custos de transporte
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                if (city.transport && city.transport.options) {
                    // Encontrar a opção recomendada para cada trecho
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    
                    if (recommendedOption) {
                        // Multiplicar por 2 para o casal
                        transportCost += recommendedOption.cost * 2;
                    }
                }
            });
            
            // Adicionar o custo do aluguel de carro
            transportCost += 95; // 95€ para 3 dias de aluguel (opção econômica)
            
            // Calcular custos de hospedagem (já é o preço do quarto para o casal)
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                if (city.accommodation) {
                    // Adicionar apenas hospedagens que precisam ser pagas
                    accommodationCost += city.accommodation.cost;
                }
            });
            
            // Estimativas para alimentação, atrações e extras PARA DUAS PESSOAS
            const foodCostPerDay = 18; // 18€ por pessoa por dia (economizando)
            const foodCost = totalDays * foodCostPerDay * 2; // Para duas pessoas
            
            // Atrações principais (para duas pessoas)
            const attractionsCost = 2 * (
                0 + // Bernabéu (apenas exterior, gratuito)
                35 + // Oceanográfico (com desconto)
                70 + // Tobogã Suíço (pacote básico)
                16 + // Keukenhof (com desconto)
                40 + // Giethoorn (transporte público)
                30   // Outras atrações com descontos
            );
            
            const extrasCost = totalDays * 5 * 2 / 4; // Reduzido drasticamente para 25% do valor original
            
            // Custo total
            const totalCost = transportCost + accommodationCost + foodCost + attractionsCost + extrasCost;
            
            return {
                transport: Math.round(transportCost),
                accommodation: Math.round(accommodationCost),
                food: Math.round(foodCost),
                attractions: Math.round(attractionsCost),
                extras: Math.round(extrasCost),
                totalCost: Math.round(totalCost)
            };
        }

        function showFinancialSummary() {
            const costs = calculateTotalCosts();
            const totalBudget = 1000; // Orçamento definido por pessoa
            const totalCouplesBudget = totalBudget * 2;
            
            // Dados para gráficos
            const categoryLabels = ['Transportes', 'Hospedagem', 'Alimentação', 'Atrações', 'Extras'];
            const categoryData = [costs.transport, costs.accommodation, costs.food, costs.attractions, costs.extras];
            const categoryColors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
            
            // Dados para gráfico de cidades
            const cityCosts = [];
            itineraryData.order.forEach(cityId => {
                const city = itineraryData.cities[cityId];
                let cityTotal = 0;
                
                // Adicionar custo de hospedagem
                if (city.accommodation) {
                    cityTotal += city.accommodation.cost;
                }
                
                // Adicionar custo de transporte
                if (city.transport && city.transport.options) {
                    const recommendedOption = city.transport.options.find(option => option.recommended);
                    if (recommendedOption) {
                        cityTotal += recommendedOption.cost * 2; // Para o casal
                    }
                }
                
                // Adicionar estimativa de gasto diário
                const dailyCost = cityId === 'porto' ? 36 * 2 + 95 : 36 * 2; // Porto inclui aluguel do carro, *2 para o casal
                cityTotal += dailyCost;
                
                // Adicionar custo de atrações especiais
                if (city.name.includes("Madrid")) {
                    cityTotal += 0 * 2; // Bernabéu exterior (gratuito)
                } else if (city.name.includes("Valencia")) {
                    cityTotal += 35 * 2; // Oceanográfico com desconto
                } else if (city.special && city.name.includes("Geneva") || city.name.includes("Pilatus")) {
                    cityTotal += 70 * 2; // Tobogã com pacote básico
                } else if (city.name.includes("Amsterdam")) {
                    cityTotal += (16 + 40) * 2; // Keukenhof + Giethoorn (transporte público)
                }
                
                cityCosts.push({
                    name: city.name,
                    cost: cityTotal
                });
            });
            
            // Preparar resumo por cidade
            const citySummaryHtml = cityCosts.map(city => `
                <div class="cost-item">
                    <span>${city.name}:</span>
                    <span>€${city.cost.toFixed(2)}</span>
                </div>
            `).join('');
            
            // Verificar se o orçamento é suficiente
            const budgetRemaining = totalCouplesBudget - costs.totalCost;
            const budgetPercentage = (costs.totalCost / totalCouplesBudget) * 100;
            const budgetClass = budgetRemaining >= 0 ? 'budget-within' : 'budget-over';
            const budgetOverviewClass = budgetRemaining >= 0 ? '' : 'over-budget';
            
            document.getElementById('fullItinerary').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">Resumo Financeiro - Roteiro Final</h2>
                
                <div class="budget-overview ${budgetOverviewClass}">
                    <h3>Orçamento Total (Casal): €${totalCouplesBudget}</h3>
                    <div class="budget-meter">
                        <div class="budget-fill ${budgetClass}" style="width: ${Math.min(budgetPercentage, 100)}%;"></div>
                    </div>
                    <p><strong>Custo Estimado:</strong> €${costs.totalCost.toFixed(2)}</p>
                    <p><strong>${budgetRemaining >= 0 ? 'Saldo Restante' : 'Excedente'}: </strong> 
                       €${Math.abs(budgetRemaining).toFixed(2)} ${budgetRemaining >= 0 ? '✅' : '❌'}</p>
                </div>
                
                <div class="savings-highlight">
                    <h4>Economia Total no Roteiro Otimizado</h4>
                    <p>Comparação entre o roteiro original e o otimizado:</p>
                    
                    <table class="comparison-table">
                        <tr>
                            <th>Categoria</th>
                            <th>Valor Original (€)</th>
                            <th>Valor Otimizado (€)</th>
                            <th>Economia (€)</th>
                        </tr>
                        <tr>
                            <td>Transporte</td>
                            <td>1,180</td>
                            <td>${costs.transport}</td>
                            <td>${1180 - costs.transport}</td>
                        </tr>
                        <tr>
                            <td>Hospedagem</td>
                            <td>675</td>
                            <td>${costs.accommodation}</td>
                            <td>${675 - costs.accommodation}</td>
                        </tr>
                        <tr>
                            <td>Alimentação</td>
                            <td>750</td>
                            <td>${costs.food}</td>
                            <td>${750 - costs.food}</td>
                        </tr>
                        <tr>
                            <td>Atrações</td>
                            <td>430</td>
                            <td>${costs.attractions}</td>
                            <td>${430 - costs.attractions}</td>
                        </tr>
                        <tr>
                            <td>Extras</td>
                            <td>200</td>
                            <td>${costs.extras}</td>
                            <td>${200 - costs.extras}</td>
                        </tr>
                        <tr class="highlight-row">
                            <td><strong>TOTAL</strong></td>
                            <td><strong>3,235</strong></td>
                            <td><strong>${costs.totalCost}</strong></td>
                            <td><strong>${3235 - costs.totalCost}</strong></td>
                        </tr>
                    </table>
                    
                    <p style="margin-top: 15px;"><strong>Custo por pessoa:</strong> €${Math.round(costs.totalCost / 2)} (dentro do orçamento de €2.000/pessoa)</p>
                </div>
                
                <div class="portugal-highlight">
                    <h4>Distribuição de Custos no Roteiro Atualizado</h4>
                    <p>O roteiro final com estadia estendida em Porto tem a seguinte distribuição de custos:</p>
                    
                    <table class="comparison-table">
                        <tr>
                            <th>Região</th>
                            <th>Duração</th>
                            <th>Custo Aproximado</th>
                            <th>Destaques</th>
                        </tr>
                        <tr>
                            <td>Espanha</td>
                            <td>2 noites</td>
                            <td>€270</td>
                            <td>Madrid, Oceanográfico</td>
                        </tr>
                        <tr>
                            <td>Suíça</td>
                            <td>4 noites</td>
                            <td>€950</td>
                            <td>Tobogã alpino, Geneva</td>
                        </tr>
                        <tr>
                            <td>Holanda</td>
                            <td>2 noites</td>
                            <td>€410</td>
                            <td>Keukenhof, Giethoorn</td>
                        </tr>
                        <tr class="highlight-row">
                            <td>Portugal</td>
                            <td>3 noites</td>
                            <td>€390</td>
                            <td>Porto (2 noites), Foz Tua, Gerês</td>
                        </tr>
                    </table>
                    
                    <p>A Suíça ainda representa o maior custo do roteiro devido aos preços mais elevados no país, mas as economias aplicadas permitiram aumentar o tempo em Portugal.</p>
                </div>
                
                <div class="cost-charts">
                    <div class="chart-container">
                        <h3>Distribuição de Custos por Categoria</h3>
                        <canvas id="categoriesChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Custo por Destino</h3>
                        <canvas id="citiesChart"></canvas>
                    </div>
                </div>
                
                <div class="city-info">
                    <h3>Resumo de Custos por Categoria (Para o Casal)</h3>
                    <div class="cost-item">
                        <span>Transportes:</span>
                        <span>€${costs.transport.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Hospedagem:</span>
                        <span>€${costs.accommodation.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Alimentação:</span>
                        <span>€${costs.food.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Atrações:</span>
                        <span>€${costs.attractions.toFixed(2)}</span>
                    </div>
                    <div class="cost-item">
                        <span>Extras:</span>
                        <span>€${costs.extras.toFixed(2)}</span>
                    </div>
                    <div class="total-cost">
                        <span>Total para o Casal:</span>
                        <span>€${costs.totalCost.toFixed(2)}</span>
                    </div>
                    <div class="total-cost">
                        <span>Custo por Pessoa:</span>
                        <span>€${Math.round(costs.totalCost / 2).toFixed(2)}</span>
                    </div>
                </div>
                
                <div class="city-info">
                    <h3>Resumo de Custos por Cidade</h3>
                    ${citySummaryHtml}
                </div>
                
                <div class="savings-highlight">
                    <h3>Dicas Gerais para Economizar</h3>
                    <ul>
                        <li><strong>Reservas antecipadas:</strong> Reserve todos os transportes e hospedagens com 3+ meses de antecedência</li>
                        <li><strong>Alimentação:</strong> Prepare café da manhã e algumas refeições nos alojamentos (economia de 30-40%)</li>
                        <li><strong>Água:</strong> Leve garrafa reutilizável e reabasteça em fontes públicas (especialmente na Suíça)</li>
                        <li><strong>Souvenirs:</strong> Defina um limite de gastos antes da viagem (ex: €50 por pessoa)</li>
                        <li><strong>Cartões turísticos:</strong> Avalie se vale a pena em cada cidade (nem sempre são econômicos)</li>
                        <li><strong>Voos:</strong> Use modo anônimo ao pesquisar e verifique datas alternativas</li>
                        <li><strong>Wi-Fi:</strong> Baixe mapas offline antes da viagem para economizar em dados móveis</li>
                    </ul>
                </div>
            `;
            
            // Criar gráficos após o HTML estar pronto
            setTimeout(() => {
                createCategoryChart(categoryLabels, categoryData, categoryColors);
                createCityChart(cityCosts);
            }, 100);
        }

        function createCategoryChart(labels, data, colors) {
            const ctx = document.getElementById('categoriesChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = Math.round((value / context.dataset.data.reduce((a, b) => a + b, 0)) * 100);
                                    return `${label}: €${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createCityChart(cityCosts) {
            const ctx = document.getElementById('citiesChart').getContext('2d');
            const cityNames = cityCosts.map(city => city.name.split(' ')[0]); // Primeiro nome apenas para legibilidade
            const cityValues = cityCosts.map(city => city.cost);
            const backgroundColors = cityCosts.map((city, index) => {
                if (city.name.includes('Amsterdam')) {
                    return '#3498db'; // Azul para destacar Amsterdam
                } else if (city.name.includes('Zurich') || city.name.includes('Geneva')) {
                    return '#9b59b6'; // Roxo para destinos suíços
                } else if (city.name.includes('Porto') || city.name.includes('Gerês')) {
                    return '#e74c3c'; // Vermelho para destinos portugueses
                }
                const hue = (index * 30) % 360;
                return `hsl(${hue}, 70%, 60%)`;
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cityNames,
                    datasets: [{
                        label: 'Custo por Cidade (€)',
                        data: cityValues,
                        backgroundColor: backgroundColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Custo (€)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Inicializar o mapa quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se a biblioteca Leaflet foi carregada
            function initMap() {
                if (typeof L !== 'undefined') {
                    map = L.map('map').setView([45.0, 10.0], 5);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(map);
                    updateMap();
                } else {
                    // Se o Leaflet ainda não estiver carregado, tente novamente em 100ms
                    setTimeout(initMap, 100);
                }
            }
            
            initMap();
        });
    </script>
</body>
</html>
